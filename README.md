  <a href="https://git.io/typing-svg">
    <img src="https://readme-typing-svg.herokuapp.com?font=Fira+Code&weight=700&size=45&pause=1000&color=00E5FF&center=true&vCenter=true&width=1500&lines=Network+Automation+Series;Building+Intent-Based+Networks;AI-Powered+Networking+with+MCP" alt="Network Automation Series" />
  </a>
</p>

<p align="center">
  <img src="assets/Series Thumpnail.jpg" alt="Network Coder Banner" width="800">
</p>

<p align="center">
  <img src="https://img.shields.io/badge/Network-007ACC?style=for-the-badge" alt="Network">
  <img src="https://img.shields.io/badge/AI-8A2BE2?style=for-the-badge" alt="AI">
  <img src="https://img.shields.io/badge/AI_Agents-141414?style=for-the-badge&logo=openai&logoColor=00F5FF" alt="AI Agents">
  <img src="https://img.shields.io/badge/MCP-FF8C00?style=for-the-badge" alt="MCP">
  <img src="https://img.shields.io/badge/Automation-D1242F?style=for-the-badge" alt="Automation">
  <img src="https://img.shields.io/badge/Virtual_LAB-228B22?style=for-the-badge" alt="Virtual Lab">
</p>

<p align="center">
  <a href="https://youtube.com/@NetworkCoder"><img src="https://img.shields.io/badge/Tutorials-FF0000?style=for-the-badge&logo=youtube&logoColor=white" alt="YouTube"></a>
  <a href="https://www.linkedin.com/in/hadeek"><img src="https://img.shields.io/badge/Connect-0A66C2?style=for-the-badge&logo=linkedin&logoColor=white" alt="LinkedIn"></a>
  <a href="https://github.com/network-tocoder"><img src="https://img.shields.io/badge/Projects-181717?style=for-the-badge&logo=github&logoColor=white" alt="GitHub"></a>
</p>

---

## ğŸ“ What You'll Learn

This series takes you from zero to hero in network automation. Build a complete virtual lab in EVE-NG, automate firewalls, deploy NetBox for infrastructure management, and integrate everything with modern DevOps tools and AI.

---

## ğŸ“º Video Index

| # | Video | Topic | ğŸ¬ Watch |
|---|-------|-------|----------|
| 1 | [EVE-NG Installation](#video-1-eve-ng-installation--first-virtual-lab) | EVE-NG, Virtual Lab Setup | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=ABNOS7GypxA) |
| 2 | [Build Automation Environment](#video-2-build-automation-environment-inside-eve-ng) | Linux, Ansible, VS Code | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=NPq7AjCguBY) |
| 3 | [Git Workflow](#video-3-git-workflow-for-network-engineers) | Git, GitHub, Version Control | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=vykDi7PFeW0) |
| 4 | [Deploy FortiGate](#video-4-deploy-fortigate-firewall-on-eve-ng) | FortiGate, EVE-NG | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=8W9OJAP773s) |
| 5 | [FortiGate Ansible](#video-5-fortigate-automation-using-ansible) | Ansible, Vault, Playbooks | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=3VL-JRIJT8M) |
| 6 | [FortiGate REST API](#video-6-fortigate-automation-using-rest-api) | REST API, Postman | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=Eqy4q9SsmtE) |
| 7 | [NetBox Docker](#video-7-netbox-installation-using-docker) | NetBox, Docker | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=OGQGly7NIFY) |
| 8 | [NetBox Dynamic Inventory](#video-8-netbox-dynamic-inventory---core-concepts-explained) | DIODE, ORB, Architecture | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=nD9FeG8A44o) |
| 9 | [NetBox Auto-Discovery](#video-9-netbox-auto-discovery---complete-setup-guide) | DIODE, ORB Agent, OAuth | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=DODzEsMTmKQ) |
| 10 | [pyATS + NetBox](#video-10-pyats--netbox-integration) | pyATS, Testing, NetBox | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=V_PmWxC2QDA) |
| 11 | [MCP Fundamentals](#video-11-mcp-fundamentals---connect-ai-to-network-tools) | MCP Core Concepts, Architecture | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=DDQL5OQDLJU) |
| 12 | [NetBox + MCP Hands-On](#video-12-netbox--mcp-hands-on-setup) | Claude CLI, NetBox MCP | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=1CImPJ6g0ns) |
| 13 | [Custom Device MCP](#video-13-custom-mcp-server---network-device-automation) | Netmiko, SSH, FastMCP | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=vtDuhAP-KfQ) |
| 14 | [Ansible Dynamic Inventory](#video-14-ansible-dynamic-inventory-with-netbox) | Ansible, NetBox Plugin | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=YwZ6c96R_v0) |
| 15 | [Ansible MCP Integration](#video-15-ansible-mcp-integration) | Ansible + MCP + Claude | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=rN9GJgPKeCQ) |
| 16 | [Gemini CLI + Remote MCP](#video-16-gemini-cli--remote-mcp) | Gemini CLI, SSE, FREE | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=KdHF4fGbNdE) |
| 17 | [AWX Installation](#video-17-awx-installation-on-k3s) | K3s, Kubernetes, AWX | [â–¶ï¸ YouTube](https://www.youtube.com/watch?v=uoIo6gCgc1M) |
| 18 | [AWX Execution Environments](#video-18-awx-execution-environments) | Custom EE, ansible-builder | ğŸ”œ Coming Soon |

---

## ğŸ› ï¸ Tech Stack

![EVE-NG](https://img.shields.io/badge/EVE--NG-00A98F?style=flat-square&logo=vmware&logoColor=white)
![Docker](https://img.shields.io/badge/Docker-2496ED?style=flat-square&logo=docker&logoColor=white)
![Ansible](https://img.shields.io/badge/Ansible-EE0000?style=flat-square&logo=ansible&logoColor=white)
![Python](https://img.shields.io/badge/Python-3776AB?style=flat-square&logo=python&logoColor=white)
![NetBox](https://img.shields.io/badge/NetBox-0078D4?style=flat-square&logo=buffer&logoColor=white)
![FortiGate](https://img.shields.io/badge/FortiGate-EE3124?style=flat-square&logo=fortinet&logoColor=white)
![Cisco](https://img.shields.io/badge/Cisco-1BA0D7?style=flat-square&logo=cisco&logoColor=white)
![AWX](https://img.shields.io/badge/AWX-EE0000?style=flat-square&logo=ansible&logoColor=white)
![K3s](https://img.shields.io/badge/K3s-FFC61C?style=flat-square&logo=kubernetes&logoColor=black)
![Gemini](https://img.shields.io/badge/Gemini-4285F4?style=flat-square&logo=google&logoColor=white)

---

## Video 1: EVE-NG Installation & First Virtual Lab

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=ABNOS7GypxA)

### ğŸ“‹ Overview

Install EVE-NG on VMware Workstation and build your first virtual network topology.

### ğŸ¯ What You'll Learn

- Download and install EVE-NG Community Edition
- Configure VMware Workstation network settings
- Initial EVE-NG configuration
- Add network device images
- Create your first topology

### ğŸ’» Commands

<details>
<summary>1. VMware Network Configuration</summary>

```bash
# Open Virtual Network Editor
# Edit > Virtual Network Editor > Change Settings

# Configure VMnet0 - Bridge to physical adapter
# This allows EVE-NG to use your home network IP range
```

</details>

<details>
<summary>2. EVE-NG VM Settings</summary>

```bash
# Recommended VM Settings:
# - Processors: 2 processors x 2 cores = 4 vCPUs
# - Memory: 8GB minimum (16GB recommended)
# - Hard Disk: 80GB
# - Network Adapter: Bridged (VMnet0)
# - Guest OS: Linux > Ubuntu 64-bit
```

</details>

<details>
<summary>3. EVE-NG Initial Setup</summary>

```bash
# Default credentials after installation
# Username: root
# Password: eve

# Update EVE-NG
apt update && apt upgrade -y

# Fix permissions (run after adding images)
/opt/unetlab/wrappers/unl_wrapper -a fixpermissions
```

</details>

<details>
<summary>4. Key EVE-NG Directories</summary>

```bash
# Lab files location
/opt/unetlab/labs/

# QEMU images (routers, firewalls)
/opt/unetlab/addons/qemu/

# IOL images (Cisco IOS)
/opt/unetlab/addons/iol/bin/

# Docker images
/opt/unetlab/addons/docker/

# Running lab configurations
/opt/unetlab/tmp/
```

</details>

<details>
<summary>5. Add Network Device Images</summary>

```bash
# Upload images via WinSCP/SCP to appropriate directory
# Example: Cisco IOL images
cd /opt/unetlab/addons/iol/bin/

# After uploading, fix permissions
/opt/unetlab/wrappers/unl_wrapper -a fixpermissions

# Verify images
ls -la /opt/unetlab/addons/qemu/
ls -la /opt/unetlab/addons/iol/bin/
```

</details>

### ğŸ”— Resources

- [EVE-NG Official Website](https://www.eve-ng.net/)
- [EVE-NG Documentation](https://www.eve-ng.net/index.php/documentation/)

---

## Video 2: Build Automation Environment Inside EVE-NG

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=NPq7AjCguBY)

### ğŸ“‹ Overview

Deploy Linux node in EVE-NG, install Ansible, and integrate VS Code for professional development workflow.

### ğŸ¯ What You'll Learn

- Add Linux node to EVE-NG topology
- Install Python and Ansible
- Configure VS Code Remote SSH
- Set up virtual environment best practices

### ğŸ’» Commands

<details>
<summary>1. Download & Install Ubuntu Cloud Image</summary>

```bash
# On EVE-NG server - download Ubuntu cloud image
mkdir -p /tmp/ubuntu-download
cd /tmp/ubuntu-download

wget https://cloud-images.ubuntu.com/releases/22.04/release/ubuntu-22.04-server-cloudimg-amd64.img

# Rename to EVE-NG format
mv ubuntu-22.04-server-cloudimg-amd64.img virtioa.qcow2

# Move to EVE-NG directory
mkdir -p /opt/unetlab/addons/qemu/linux-ubuntu-22.04
mv virtioa.qcow2 /opt/unetlab/addons/qemu/linux-ubuntu-22.04/

# Fix permissions
/opt/unetlab/wrappers/unl_wrapper -a fixpermissions

# Verify installation
ls -la /opt/unetlab/addons/qemu/linux-ubuntu-22.04/
```

</details>

<details>
<summary>2. Linux Node Initial Setup</summary>

```bash
# Default credentials for EVE-NG Linux images
# Username: root
# Password: eve

# Update system
sudo apt update && sudo apt upgrade -y

# Install essential tools
sudo apt install -y python3 python3-pip python3-venv git curl wget vim
```

</details>

<details>
<summary>3. Create Python Virtual Environment</summary>

```bash
# Create virtual environment
python3 -m venv ~/ansible-venv

# Activate virtual environment
source ~/ansible-venv/bin/activate

# Upgrade pip
pip install --upgrade pip

# Create activation alias (add to ~/.bashrc)
echo 'alias netdev="source ~/ansible-venv/bin/activate"' >> ~/.bashrc
source ~/.bashrc

# Now you can use 'netdev' to activate
netdev
```

</details>

<details>
<summary>4. Install Ansible</summary>

```bash
# Activate virtual environment first
source ~/ansible-venv/bin/activate

# Install Ansible
pip install ansible

# Install additional useful packages
pip install paramiko netmiko napalm

# Verify installation
ansible --version
python3 --version
pip list
```

</details>

<details>
<summary>5. VS Code Remote SSH Setup</summary>

```bash
# On Linux node - Install OpenSSH Server
sudo apt install openssh-server -y

# Start and enable SSH service
sudo systemctl start ssh
sudo systemctl enable ssh

# Check SSH status
sudo systemctl status ssh

# Configure firewall (if enabled)
sudo ufw allow ssh

# Get IP address for VS Code connection
ip addr show
```

**In VS Code:**
1. Install "Remote - SSH" extension
2. Press `F1` > "Remote-SSH: Connect to Host"
3. Enter: `username@<linux-node-ip>`
4. Open folder: `/home/username/`
5. Install Python extension in remote environment

</details>

### ğŸ”— Resources

- [Ansible Documentation](https://docs.ansible.com/)
- [VS Code Remote SSH](https://code.visualstudio.com/docs/remote/ssh)

---

## Video 3: Git Workflow for Network Engineers

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=vykDi7PFeW0)

### ğŸ“‹ Overview

Complete Git workflow for network engineers - version control for Ansible projects.

### ğŸ¯ What You'll Learn

- Git fundamentals for network automation
- Create GitHub repository
- Push Ansible playbooks to GitHub
- Best practices for version control

### ğŸ’» Commands

<details>
<summary>1. Install Git</summary>

```bash
# Install Git
sudo apt install git -y

# Verify installation
git --version

# Configure Git (use your details)
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# Verify configuration
git config --list
```

</details>

<details>
<summary>2. Initialize Local Repository</summary>

```bash
# Navigate to your project directory
cd ~/ansible-projects

# Initialize Git repository
git init

# Check repository status
git status

# Create .gitignore file
cat << 'EOF' > .gitignore
# Python
__pycache__/
*.py[cod]
*.venv/
venv/

# Ansible
*.retry
*.log

# Sensitive files
inventory/hosts
group_vars/vault.yml
*vault*

# IDE
.vscode/
.idea/
EOF

# View .gitignore
cat .gitignore
```

</details>

<details>
<summary>3. Stage and Commit Files</summary>

```bash
# Add all files to staging
git add .

# Or add specific files
git add playbook.yml inventory/

# Check staged files
git status

# Commit with message
git commit -m "Initial commit: Ansible project structure"

# View commit history
git log
git log --oneline
```

</details>

<details>
<summary>4. Create GitHub Repository</summary>

```bash
# On GitHub.com:
# 1. Click "+" (top right) > "New repository"
# 2. Repository name: ansible-network-automation
# 3. Description: Network automation with Ansible
# 4. Choose: Private or Public
# 5. Do NOT initialize with README
# 6. Click "Create repository"
# 7. Copy the repository URL
```

</details>

<details>
<summary>5. Connect Local to GitHub</summary>

```bash
# Add remote repository (use HTTPS or SSH)
git remote add origin https://github.com/yourusername/ansible-network-automation.git

# Verify remote
git remote -v

# Push to GitHub
git push -u origin main

# Or if branch is named 'master'
git branch -M main
git push -u origin main
```

</details>

<details>
<summary>6. Daily Git Workflow</summary>

```bash
# Check current status
git status

# Pull latest changes (if working in team)
git pull

# Make changes to your files...

# Check what changed
git diff

# Stage changes
git add .

# Commit changes
git commit -m "Add VLAN configuration playbook"

# Push to GitHub
git push

# View commit history
git log --oneline --graph
```

</details>

<details>
<summary>7. GitHub SSH Authentication (Recommended)</summary>

```bash
# Generate SSH key
ssh-keygen -t ed25519 -C "your.email@example.com"
# Press Enter for default location
# Enter passphrase (optional)

# Copy SSH public key
cat ~/.ssh/id_ed25519.pub

# On GitHub.com:
# 1. Settings > SSH and GPG keys
# 2. Click "New SSH key"
# 3. Paste your public key
# 4. Click "Add SSH key"

# Test SSH connection
ssh -T git@github.com

# Change remote to SSH
git remote set-url origin git@github.com:yourusername/ansible-network-automation.git

# Verify
git remote -v
```

</details>

<details>
<summary>8. Branching Strategy</summary>

```bash
# Create new branch
git branch feature/new-playbook

# Switch to branch
git checkout feature/new-playbook

# Or create and switch in one command
git checkout -b feature/new-playbook

# List all branches
git branch

# Make changes and commit
git add .
git commit -m "Add new feature"

# Push branch to GitHub
git push origin feature/new-playbook

# Switch back to main
git checkout main

# Merge branch
git merge feature/new-playbook

# Delete branch
git branch -d feature/new-playbook
```

</details>

### ğŸ”— Resources

- [Git Documentation](https://git-scm.com/doc)
- [GitHub Guides](https://guides.github.com/)

---

## Video 4: Deploy FortiGate Firewall on EVE-NG

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=8W9OJAP773s)

### ğŸ“‹ Overview

Deploy FortiGate virtual firewall in EVE-NG for security automation testing.

### ğŸ¯ What You'll Learn

- Download FortiGate VM image
- Add FortiGate to EVE-NG
- Initial FortiGate configuration
- Network connectivity setup

### ğŸ’» Commands

<details>
<summary>1. Download FortiGate VM Image</summary>

```bash
# Visit: https://support.fortinet.com/
# Login with account (free trial available)
# Download: FortiGate-VM64-KVM (QCOW2 format)
# Version: Latest 7.x

# On your computer, upload to EVE-NG via SCP
scp FGT_VM64_KVM-v7.x.x-build.out root@<eve-ng-ip>:/tmp/
```

</details>

<details>
<summary>2. Install FortiGate in EVE-NG</summary>

```bash
# On EVE-NG server
cd /tmp

# Create FortiGate directory
mkdir -p /opt/unetlab/addons/qemu/fortigate-7.4.1

# Rename image
mv FGT_VM64_KVM-v7-build*.out /opt/unetlab/addons/qemu/fortigate-7.4.1/hda.qcow2

# Fix permissions
/opt/unetlab/wrappers/unl_wrapper -a fixpermissions

# Verify installation
ls -la /opt/unetlab/addons/qemu/fortigate-7.4.1/
```

</details>

<details>
<summary>3. FortiGate Initial Configuration</summary>

```bash
# Default credentials
# Username: admin
# Password: (blank - press Enter)

# Initial setup via console
# Set admin password
config system admin
    edit admin
        set password YourStrongPassword
    end

# Configure hostname
config system global
    set hostname FortiGate-VM
end

# Configure management interface
config system interface
    edit port1
        set mode static
        set ip 192.168.1.99/24
        set allowaccess ping https ssh http
    end

# Configure default gateway
config router static
    edit 1
        set gateway 192.168.1.1
        set device port1
    next
end

# Configure DNS
config system dns
    set primary 8.8.8.8
    set secondary 8.8.4.4
end

# Save configuration
execute save config
```

</details>

<details>
<summary>4. Verify Connectivity</summary>

```bash
# Check interface status
get system interface physical

# Test ping
execute ping 8.8.8.8

# Check routes
get router info routing-table all

# Access via GUI
# https://192.168.1.99
# Username: admin
# Password: YourStrongPassword
```

</details>

### ğŸ”— Resources

- [FortiGate Documentation](https://docs.fortinet.com/)
- [FortiGate Cookbook](https://docs.fortinet.com/product/fortigate)

---


## Video 5: FortiGate Automation Using Ansible

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=3VL-JRIJT8M)

### ğŸ“‹ Overview

Automate FortiGate firewalls using Ansible with secure credential storage via Ansible Vault.

### ğŸ¯ What You'll Learn

- Install Ansible Collections for FortiGate
- Ansible Vault Setup
- Demo Playbook 1 - System Information Check
- Demo Playbook 2 - Deploy Firewall Policy

### ğŸ“ Project Structure

```
ansible-project/
â”œâ”€â”€ ansible.cfg
â”œâ”€â”€ inventory/
â”‚   â””â”€â”€ hosts
â”œâ”€â”€ host_vars/
â”‚   â””â”€â”€ Forti-FW-1.yml (encrypted)
â””â”€â”€ playbooks/
    â”œâ”€â”€ fortigate_system_info.yml
    â””â”€â”€ fortigate_create_policy.yml
```

### ğŸ’» Commands

<details>
<summary>1. Install FortiGate Collection</summary>

```bash
# Check Ansible version
ansible --version

# Install FortiGate collection
ansible-galaxy collection install fortinet.fortios

# Verify installation
ansible-galaxy collection list | grep fortinet
```

</details>

<details>
<summary>2. Ansible Vault Commands</summary>

```bash
# Create encrypted vault file
ansible-vault create host_vars/Forti-FW-1.yml

# View encrypted file (shows encrypted text)
cat host_vars/Forti-FW-1.yml

# View decrypted content
ansible-vault view host_vars/Forti-FW-1.yml

# Edit encrypted file
ansible-vault edit host_vars/Forti-FW-1.yml

# Change vault password
ansible-vault rekey host_vars/Forti-FW-1.yml
```

</details>

<details>
<summary>3. Inventory Verification</summary>

```bash
# List all inventory with vault decryption
ansible-inventory --list -i inventory/hosts --ask-vault-pass

# Check specific host variables
ansible-inventory --host Forti-FW-1 --ask-vault-pass

# View inventory in YAML format
ansible-inventory --list -i inventory/hosts --ask-vault-pass --yaml
```

</details>

<details>
<summary>4. Run Playbooks</summary>

```bash
# Run system info playbook
ansible-playbook playbooks/fortigate_system_info.yml --ask-vault-pass

# Run with verbose output
ansible-playbook playbooks/fortigate_system_info.yml --ask-vault-pass -vvv

# Create firewall policy
ansible-playbook playbooks/fortigate_create_policy.yml --ask-vault-pass

# Dry run (check mode)
ansible-playbook playbooks/fortigate_create_policy.yml --ask-vault-pass --check
```

</details>

<details>
<summary>5. Inventory File (inventory/hosts)</summary>

```ini
[fortigates]
Forti-FW-1 ansible_host=192.168.1.111

[fortigates:vars]
ansible_network_os=fortinet.fortios.fortios
ansible_connection=httpapi
ansible_httpapi_use_ssl=yes
ansible_httpapi_validate_certs=no
ansible_httpapi_port=443
```

</details>

### ğŸ”— Resources

- [Fortinet Ansible Collection](https://galaxy.ansible.com/fortinet/fortios)
- [FortiOS Ansible Docs](https://ansible-galaxy-fortios-docs.readthedocs.io/)

---

## Video 6: FortiGate Automation Using REST API

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=Eqy4q9SsmtE)

### ğŸ“‹ Overview

Automate FortiGate using REST API with Postman and VS Code integration.

### ğŸ¯ What You'll Learn

- FortiGate's API structure
- Postman Collection Setup
- VS Code API Query Setup
- Postman - GitHub Integration

### ğŸ“ FortiGate API Structure

```
/api/v2/
â”œâ”€â”€ cmdb/      â†’ Configuration (Create, Read, Update, Delete)
â”œâ”€â”€ monitor/   â†’ Status & Monitoring (Read-only)
â””â”€â”€ log/       â†’ Logs & Events (Read-only)
```

### ğŸ”§ Postman Environment Variables

| Variable | Value |
|----------|-------|
| `base_url` | `https://your-fortigate-ip` |
| `api_token` | `your-api-token` |
| `vdom` | `root` |

### ğŸ’» API Endpoints & Commands

<details>
<summary>1. GET - System Monitoring</summary>

**Endpoint:**
```
https://{{base_url}}/api/v2/monitor/system/status?vdom={{vdom}}
```

**cURL:**
```bash
curl -k -X GET "https://192.168.1.111/api/v2/monitor/system/status?vdom=root" \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

**Headers:**
```
Authorization: Bearer {{api_token}}
```

</details>

<details>
<summary>2. POST - Create Firewall Address</summary>

**Endpoint:**
```
https://{{base_url}}/api/v2/cmdb/firewall/address?vdom={{vdom}}
```

**cURL:**
```bash
curl -k -X POST "https://192.168.1.111/api/v2/cmdb/firewall/address?vdom=root" \
  -H "Authorization: Bearer YOUR_API_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "API_Demo_Server",
    "subnet": "10.0.5.100 255.255.255.255",
    "type": "ipmask",
    "comment": "Created via Postman API"
  }'
```

**Request Body (JSON):**
```json
{
  "name": "API_Demo_Server",
  "subnet": "10.0.5.100 255.255.255.255",
  "type": "ipmask",
  "comment": "Created via Postman API"
}
```

</details>

<details>
<summary>3. PUT - Update Interface</summary>

**Endpoint:**
```
https://{{base_url}}/api/v2/cmdb/system/interface/port2?vdom={{vdom}}
```

**cURL:**
```bash
curl -k -X PUT "https://192.168.1.111/api/v2/cmdb/system/interface/port2?vdom=root" \
  -H "Authorization: Bearer YOUR_API_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "alias": "LAN-Internal",
    "description": "Updated via Postman API"
  }'
```

**Request Body (JSON):**
```json
{
  "alias": "LAN-Internal",
  "description": "Updated via Postman API"
}
```

</details>

<details>
<summary>4. GET - Firewall Addresses & Policies</summary>

```bash
# Get all firewall addresses
curl -k -X GET "https://192.168.1.111/api/v2/cmdb/firewall/address?vdom=root" \
  -H "Authorization: Bearer YOUR_API_TOKEN"

# Get all firewall policies
curl -k -X GET "https://192.168.1.111/api/v2/cmdb/firewall/policy?vdom=root" \
  -H "Authorization: Bearer YOUR_API_TOKEN"

# Get system interfaces
curl -k -X GET "https://192.168.1.111/api/v2/cmdb/system/interface?vdom=root" \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

</details>

<details>
<summary>5. POST - Create Firewall Policy</summary>

**Endpoint:**
```
https://{{base_url}}/api/v2/cmdb/firewall/policy?vdom={{vdom}}
```

**Request Body (JSON):**
```json
{
  "name": "Allow-Web-Traffic",
  "srcintf": [{"name": "port1"}],
  "dstintf": [{"name": "port2"}],
  "srcaddr": [{"name": "all"}],
  "dstaddr": [{"name": "API_Demo_Server"}],
  "service": [{"name": "HTTP"}, {"name": "HTTPS"}],
  "action": "accept",
  "status": "enable"
}
```

</details>

<details>
<summary>6. Common API Endpoints Reference</summary>

**System Monitoring (GET only):**
```
/api/v2/monitor/system/status
/api/v2/monitor/system/interface
/api/v2/monitor/system/resource/usage
/api/v2/monitor/firewall/session
```

**Configuration (GET, POST, PUT, DELETE):**
```
/api/v2/cmdb/system/interface
/api/v2/cmdb/system/global
/api/v2/cmdb/firewall/address
/api/v2/cmdb/firewall/addrgrp
/api/v2/cmdb/firewall/policy
/api/v2/cmdb/firewall/service/custom
/api/v2/cmdb/router/static
```

**Logs (GET only):**
```
/api/v2/log/memory/filter
/api/v2/log/disk/filter
```

</details>

### ğŸ”— Resources

- [FortiGate REST API Guide](https://docs.fortinet.com/document/fortigate/7.0.0/administration-guide/940602/rest-api)
- [Postman Download](https://www.postman.com/downloads/)

---

## Video 7: NetBox Installation Using Docker

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=OGQGly7NIFY)

### ğŸ“‹ Overview

Install and configure NetBox using Docker Compose for network infrastructure management.

### ğŸ¯ What You'll Learn

- Deploy NetBox with Docker Compose
- Initial NetBox configuration
- Create sites, devices, and IP addresses
- NetBox data modeling best practices

### ğŸ’» Commands

<details>
<summary>1. Install Docker & Docker Compose</summary>

```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install Docker
sudo apt install -y docker.io docker-compose

# Add user to docker group
sudo usermod -aG docker $USER

# Log out and back in for group changes to take effect
# Verify
docker --version
docker-compose --version
```

</details>

<details>
<summary>2. Clone NetBox Docker Repository</summary>

```bash
# Create directory for NetBox
mkdir -p ~/netbox-discovery
cd ~/netbox-discovery

# Clone official NetBox Docker repository
git clone -b release https://github.com/netbox-community/netbox-docker.git
cd netbox-docker

# Verify files
ls -la
```

</details>

<details>
<summary>3. Configure NetBox</summary>

```bash
# Copy example configuration
cp docker-compose.override.yml.example docker-compose.override.yml

# Generate secret key
SECRET_KEY=$(python3 -c 'import secrets; print(secrets.token_urlsafe(50))')
echo "SECRET_KEY=$SECRET_KEY"

# Create environment file
cat << EOF > .env
SUPERUSER_EMAIL=admin@example.com
SUPERUSER_PASSWORD=admin
SUPERUSER_API_TOKEN=$(python3 -c 'import secrets; print(secrets.token_hex(20))')
SECRET_KEY=$SECRET_KEY
EOF

# View configuration
cat .env
```

</details>

<details>
<summary>4. Start NetBox</summary>

```bash
# Pull Docker images
docker-compose pull

# Start NetBox
docker-compose up -d

# Check container status
docker-compose ps

# View logs
docker-compose logs -f netbox

# Wait for startup (about 2 minutes)
# Press Ctrl+C to stop following logs
```

</details>

<details>
<summary>5. Access NetBox Web UI</summary>

```bash
# Get NetBox IP
ip addr show

# Access via browser:
# http://<your-ip>:8000

# Default credentials:
# Username: admin
# Password: admin

# âš ï¸ Change password after first login!
```

</details>

<details>
<summary>6. NetBox Initial Setup</summary>

**In NetBox UI:**

1. **Create Site:**
   - Organization > Sites > Add
   - Name: HQ-DataCenter
   - Status: Active

2. **Create Device Role:**
   - Devices > Device Roles > Add
   - Name: Router
   - Color: Blue

3. **Create Manufacturer:**
   - Devices > Manufacturers > Add
   - Name: Cisco

4. **Create Device Type:**
   - Devices > Device Types > Add
   - Manufacturer: Cisco
   - Model: CSR1000v

5. **Create Device:**
   - Devices > Devices > Add
   - Name: vIOS-R1
   - Device Role: Router
   - Device Type: Cisco CSR1000v
   - Site: HQ-DataCenter
   - Status: Active

</details>

<details>
<summary>7. NetBox CLI Commands</summary>

```bash
# Enter NetBox container
docker-compose exec netbox bash

# Inside container - Django shell
python manage.py shell

# Create superuser
python manage.py createsuperuser

# Collect static files
python manage.py collectstatic --no-input

# Run migrations
python manage.py migrate

# Exit container
exit
```

</details>

<details>
<summary>8. NetBox Backup</summary>

```bash
# Backup NetBox database
docker-compose exec -T postgres pg_dump -U netbox netbox > netbox_backup_$(date +%Y%m%d).sql

# Backup media files
docker-compose exec netbox tar -czf /tmp/media_backup.tar.gz /opt/netbox/netbox/media
docker cp netbox-docker_netbox_1:/tmp/media_backup.tar.gz ./media_backup_$(date +%Y%m%d).tar.gz

# List backups
ls -lh netbox_backup* media_backup*
```

</details>

### ğŸ”— Resources

- [NetBox Documentation](https://docs.netbox.dev/)
- [NetBox Docker GitHub](https://github.com/netbox-community/netbox-docker)

---

## Video 8: NetBox Dynamic Inventory - Core Concepts Explained

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=JZ-jDCT8mQY)

### ğŸ“‹ Overview

Understand the architecture of NetBox Auto-Discovery using DIODE and ORB Agent.

### ğŸ¯ What You'll Learn

- NetBox Auto-Discovery architecture
- DIODE Server components
- ORB Agent functionality
- Data flow and OAuth authentication

### ğŸ—ï¸ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ORB Agent     â”‚â”€â”€â”€â”€â–¶â”‚  DIODE Server   â”‚â”€â”€â”€â”€â–¶â”‚ NetBox Plugin   â”‚
â”‚  (Discovery)    â”‚     â”‚  (Processing)   â”‚     â”‚   (Storage)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚                        â”‚
       â”‚                        â”‚                        â”‚
       â–¼                        â–¼                        â–¼
  SSH/SNMP               PostgreSQL                  NetBox DB
  Devices                   Hydra                     
                          OAuth 2.0
```

### ğŸ“ Key Components

<details>
<summary>1. ORB Agent - Discovery Engine</summary>

**Purpose:** Discovers network devices and collects configuration data

**How it works:**
- Runs as Docker container
- Uses NAPALM drivers for multi-vendor support
- Connects to devices via SSH/SNMP/NETCONF
- Scheduled discovery (configurable interval)
- Sends data to DIODE Server

**Supported Vendors:**
- Cisco (IOS, IOS-XE, NXOS, IOS-XR)
- Juniper (JunOS)
- Arista (EOS)
- And more via NAPALM

</details>

<details>
<summary>2. DIODE Server - Processing Layer</summary>

**Purpose:** Processes and validates network data

**Components:**
- **Ingester**: Receives data from ORB Agent
- **PostgreSQL**: Stores raw network data
- **Reconciler**: Creates NetBox changesets
- **Hydra**: OAuth 2.0 authorization server
- **Nginx**: Reverse proxy

**Data Flow:**
```
ORB Agent â†’ Ingester â†’ PostgreSQL â†’ Reconciler â†’ NetBox
                           â†“
                        Hydra (Auth)
```

</details>

<details>
<summary>3. NetBox DIODE Plugin - Integration</summary>

**Purpose:** Receives data from DIODE and updates NetBox

**Functions:**
- Pulls changesets from DIODE API
- Creates/updates devices
- Manages interfaces and IP addresses
- Handles OAuth authentication
- Provides UI for credential management

</details>

<details>
<summary>4. OAuth 2.0 Authentication Flow</summary>

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ORB Agent  â”‚                    â”‚   Hydra     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚
       â”‚  1. Request Token                â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                                  â”‚
       â”‚  2. Validate Credentials         â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚     Return JWT Token             â”‚
       â”‚                                  â”‚
       â”‚  3. Send Data + Token            â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                                  â”‚
       â”‚  4. Verify Token                 â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚     Accept Data                  â”‚
       â”‚                                  â”‚
```

**Three OAuth Clients:**
1. `orb-agent` - ORB Agent â†’ DIODE
2. `netbox-to-diode` - NetBox Plugin â†’ DIODE
3. `diode-to-netbox` - DIODE â†’ NetBox (future use)

</details>

### ğŸ”— Resources

- [DIODE GitHub](https://github.com/netboxlabs/diode)
- [ORB Agent GitHub](https://github.com/netboxlabs/orb-agent)
- [NetBox DIODE Plugin](https://github.com/netboxlabs/netbox-diode-plugin)

---

## Video 9: NetBox Auto-Discovery - Complete Setup Guide

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=DODzEsMTmKQ)

### ğŸ“‹ Overview

Complete step-by-step setup of NetBox Auto-Discovery with DIODE Server and ORB Agent.

### ğŸ¯ What You'll Learn

- Deploy DIODE Server with Docker
- Install NetBox DIODE Plugin
- Configure ORB Agent
- Troubleshoot common issues
- Live auto-discovery demonstration

### ğŸ’» Commands

<details>
<summary>1. Deploy DIODE Server</summary>

```bash
# Create directory for DIODE
mkdir -p ~/netbox-discovery/diode
cd ~/netbox-discovery/diode

# Download DIODE quick-start script
curl -o diode-quickstart.sh https://raw.githubusercontent.com/netboxlabs/diode/main/diode-quickstart.sh

# Make executable
chmod +x diode-quickstart.sh

# Run quick-start (replace with your NetBox URL)
./diode-quickstart.sh --netbox-url http://192.168.1.120:8000

# This script will:
# - Download docker-compose.yml
# - Create .env file
# - Generate OAuth credentials
# - Start all DIODE services

# View generated OAuth credentials
cat oauth2/client/client-credentials.json

# Start DIODE services
docker-compose up -d

# Check status
docker-compose ps
```

</details>

<details>
<summary>2. Install NetBox DIODE Plugin</summary>

```bash
# Navigate to NetBox directory
cd ~/netbox-docker

# Enter NetBox container as root
docker-compose exec -u root netbox bash

# Inside container - Update package list
apt update

# Install pip (if not already installed)
apt install -y python3-pip

# Install NetBox DIODE plugin
pip3 install --target=/opt/netbox/venv/lib/python3.12/site-packages \
  --break-system-packages \
  netboxlabs-diode-netbox-plugin

# Verify installation
ls -la /opt/netbox/venv/lib/python3.12/site-packages/ | grep -i diode

# Test import
/opt/netbox/venv/bin/python3 -c "import netbox_diode_plugin; print('Plugin installed successfully')"

# Exit container
exit

# Commit the container to make plugin permanent
docker commit netbox-docker-netbox-1 netbox-with-diode:latest

# Update docker-compose.override.yml to use new image
cat << 'EOF' >> docker-compose.override.yml
services:
  netbox:
    image: netbox-with-diode:latest
EOF
```

</details>

<details>
<summary>3. Configure NetBox DIODE Plugin</summary>

```bash
# Edit NetBox plugins configuration
cd ~/netbox-docker
nano configuration/plugins.py

# Add at the end of the file:
PLUGINS = [
    'netbox_diode_plugin',
]

PLUGINS_CONFIG = {
    'netbox_diode_plugin': {
        'diode_target_override': 'grpc://192.168.1.120:8080/diode',
        'netbox_to_diode_client_secret': 'YOUR_SECRET_FROM_CLIENT_CREDENTIALS_JSON',
        'hydra_admin_url': 'http://diode-hydra-1:4445',
    }
}

# Save and exit (Ctrl+O, Enter, Ctrl+X)

# Get the actual secret from DIODE credentials
cd ~/netbox-discovery/diode
cat oauth2/client/client-credentials.json | grep -A 3 "netbox-to-diode"

# Copy the client_secret value and update plugins.py

# Restart NetBox
cd ~/netbox-docker
docker-compose restart netbox netbox-worker

# Run migrations
docker-compose exec netbox python /opt/netbox/netbox/manage.py migrate

# Restart again
docker-compose restart netbox netbox-worker
```

</details>

<details>
<summary>4. Fix Network Connectivity (Critical!)</summary>

```bash
# Check if NetBox and DIODE can communicate
cd ~/netbox-docker
docker-compose exec netbox hostname -i
# Note the IP (e.g., 172.18.0.5)

cd ~/netbox-discovery/diode
docker-compose exec hydra hostname -i
# Note the IP (e.g., 172.19.0.3)

# If IPs are on different subnets, add network configuration
# Edit DIODE docker-compose.yml
nano docker-compose.yml

# Add to the BOTTOM of the file:
networks:
  default:
    external: true
    name: netbox-docker_default

# Save and exit (Ctrl+O, Enter, Ctrl+X)

# Restart DIODE services
docker-compose down
docker-compose up -d

# Verify connectivity
cd ~/netbox-docker
docker-compose exec netbox curl http://diode-hydra-1:4445/health/ready
# Should return: {"status":"ok"}
```

</details>

<details>
<summary>5. Deploy ORB Agent</summary>

```bash
# Create directory for ORB Agent
mkdir -p ~/netbox-discovery/orb-agent
cd ~/netbox-discovery/orb-agent

# Create config.yaml (use OAuth credentials from NetBox UI)
# First, create OAuth credentials in NetBox:
# NetBox UI > Plugins > DIODE > Client Credentials > Add

# Create config.yaml
cat << 'EOF' > config.yaml
discovery:
  device_credentials:
    - username: cisco
      password: cisco
      driver: ios
  interfaces:
    enabled: true
  mac_addresses:
    enabled: true
  ip_addresses:
    enabled: true
  vlans:
    enabled: true
  
devices:
  - hostname: 192.168.1.10
    driver: ios
    
  - hostname: 192.168.1.11
    driver: ios
    
  - hostname: 192.168.1.12
    driver: ios

oauth:
  client_id: your-client-id-from-netbox
  client_secret: your-client-secret-from-netbox
  token_url: http://192.168.1.120:8080/oauth2/token

diode:
  target: 192.168.1.120:8080
  
schedule:
  interval: 900  # 15 minutes
EOF

# Create docker-compose.yml for ORB Agent
cat << 'EOF' > docker-compose.yml
services:
  orb-agent:
    image: netboxlabs/orb-agent:latest
    container_name: orb-agent
    volumes:
      - /home/user/netbox-discovery/orb-agent/config.yaml:/app/config.yaml
    restart: unless-stopped
EOF

# IMPORTANT: Update path to absolute path
# Replace /home/user with your actual home directory path

# Start ORB Agent
docker-compose up -d

# Check logs
docker logs -f orb-agent
```

</details>

<details>
<summary>6. Verify Auto-Discovery</summary>

```bash
# Check ORB Agent logs
cd ~/netbox-discovery/orb-agent
docker logs orb-agent | grep "Successful ingestion"

# Check DIODE ingester logs
cd ~/netbox-discovery/diode
docker-compose logs diode-ingester | grep -i "success"

# Check DIODE reconciler logs
docker-compose logs diode-reconciler | grep "applied successfully"

# Check NetBox UI
# Navigate to: Devices > Devices
# You should see discovered devices!
```

</details>

<details>
<summary>7. Troubleshooting Commands</summary>

```bash
# Check all container status
cd ~/netbox-docker && docker-compose ps
cd ~/netbox-discovery/diode && docker-compose ps
cd ~/netbox-discovery/orb-agent && docker-compose ps

# Check NetBox plugin configuration
cd ~/netbox-docker
docker-compose exec netbox python /opt/netbox/netbox/manage.py shell
>>> from django.conf import settings
>>> print(settings.PLUGINS_CONFIG.get('netbox_diode_plugin'))
>>> exit()

# List OAuth clients in Hydra
cd ~/netbox-discovery/diode
docker-compose exec hydra hydra list clients --endpoint http://localhost:4445

# Test OAuth token generation
curl -X POST http://192.168.1.120:8080/oauth2/token \
  -d "grant_type=client_credentials" \
  -d "client_id=YOUR_CLIENT_ID" \
  -d "client_secret=YOUR_CLIENT_SECRET"

# Check DIODE API health
curl http://192.168.1.120:8080/health

# Restart all services
cd ~/netbox-docker && docker-compose restart
cd ~/netbox-discovery/diode && docker-compose restart
cd ~/netbox-discovery/orb-agent && docker-compose restart
```

</details>

### ğŸš¨ Common Issues & Solutions

<details>
<summary>âŒ Error: "Missing netbox to diode client secret"</summary>

**Screenshot:**

<p align="center">
  <img src="assets/error-missing-client-secret.png" alt="Missing Client Secret Error" width="600">
</p>

**Error Message:**
```
Please update the plugin configuration to access this feature. 
Missing netbox to diode client secret.
```

**Root Cause:**
The NetBox DIODE Plugin configuration is missing or incorrectly configured with the OAuth client secret parameter.

**Why This Happens:**
1. âŒ Incorrect parameter name used in `plugins.py` (`diode_client_secret` instead of `netbox_to_diode_client_secret`)
2. âŒ Plugin configuration not updated after initial installation
3. âŒ NetBox services not restarted after configuration changes
4. âŒ Client secret doesn't match the value in DIODE's `client-credentials.json`

---

**âœ… STEP-BY-STEP FIX:**

**1. Verify DIODE has the Client Credentials**

```bash
# Navigate to DIODE directory
cd ~/netbox-discovery/diode

# Check if client credentials file exists
cat oauth2/client/client-credentials.json
```

**Expected output:**
```json
[
  {
    "client_id": "diode-ingest",
    "client_secret": "tcgnPFpZ3qVtxyqR+sGXIexpxAk8wul2S8yu7Duans=",
    "grant_types": ["client_credentials"],
    "scope": "diode:ingest"
  },
  {
    "client_id": "netbox-to-diode",
    "client_secret": "GdS63SRQ4I0G15I0V35uQYD7V+qnNUTjZCCD10yQvQ=",
    "grant_types": ["client_credentials"],
    "scope": "diode:read diode:write"
  },
  {
    "client_id": "diode-to-netbox",
    "client_secret": "NypFsBMV1rQTRDX5jO7Utez57DwF503gk8e2QKADLU=",
    "grant_types": ["client_credentials"],
    "scope": "netbox:read netbox:write"
  }
]
```

**âœ… Copy the `netbox-to-diode` client_secret value - you'll need this!**

---

**2. Verify Hydra Has the Client**

```bash
# Check Hydra container is running
cd ~/netbox-discovery/diode
docker-compose ps hydra

# List all OAuth clients in Hydra
docker-compose exec hydra hydra list clients --endpoint http://localhost:4445
```

**Expected output should include:**
```
CLIENT ID                    GRANT TYPES              RESPONSE TYPES
netbox-to-diode              client_credentials       token
diode-to-netbox              client_credentials       token
diode-ingest                 client_credentials       token
```

**âœ… If you see `netbox-to-diode`, the client exists in Hydra**

---

**3. Check NetBox Plugin Configuration**

```bash
# Navigate to NetBox directory
cd ~/netbox-docker

# Check the plugins configuration file
cat configuration/plugins.py | grep -A 10 "netbox_diode_plugin"
```

**âŒ WRONG Configuration (causes error):**
```python
PLUGINS_CONFIG = {
    'netbox_diode_plugin': {
        'diode_target_override': 'grpc://192.168.1.20:8080/diode',
        'diode_client_id': 'netbox-to-diode',           # âŒ Plugin doesn't use this
        'diode_client_secret': 'GdS63SRQ4I0G...',       # âŒ WRONG parameter name
    }
}
```

**âœ… CORRECT Configuration:**
```python
PLUGINS_CONFIG = {
    'netbox_diode_plugin': {
        'diode_target_override': 'grpc://192.168.1.20:8080/diode',
        'netbox_to_diode_client_secret': 'GdS63SRQ4I0G15I0V35uQYD7V+qnNUTjZCCD10yQvQ=',  # âœ… CORRECT
        'hydra_admin_url': 'http://diode-hydra-1:4445',  # âœ… REQUIRED
    }
}
```

**ğŸ”‘ Key Differences:**
1. âŒ Remove `diode_client_id` - plugin doesn't use this parameter
2. âœ… Change `diode_client_secret` â†’ `netbox_to_diode_client_secret`
3. âœ… Add `hydra_admin_url` parameter (required for plugin to function)

---

**4. Update NetBox Configuration**

```bash
cd ~/netbox-docker

# Edit the plugins configuration
nano configuration/plugins.py
```

**Update to the CORRECT configuration:**

```python
PLUGINS = [
    'netbox_diode_plugin',
]

PLUGINS_CONFIG = {
    'netbox_diode_plugin': {
        'diode_target_override': 'grpc://192.168.1.20:8080/diode',
        'netbox_to_diode_client_secret': 'GdS63SRQ4I0G15I0V35uQYD7V+qnNUTjZCCD10yQvQ=',  # Use YOUR actual secret
        'hydra_admin_url': 'http://diode-hydra-1:4445',
    }
}
```

**ğŸ“ Replace the secret with YOUR actual value from `client-credentials.json`**

**Save:** `Ctrl+O`, `Enter`, `Ctrl+X`

---

**5. Restart NetBox Services**

```bash
cd ~/netbox-docker

# Restart NetBox and NetBox worker
docker-compose restart netbox netbox-worker

# Wait 30 seconds for services to fully restart
sleep 30

# Check if services are running
docker-compose ps
```

**Expected:** Both `netbox` and `netbox-worker` should show status "Up"

---

**6. Verify Configuration Was Applied**

```bash
# Enter NetBox container Python shell
docker-compose exec netbox python /opt/netbox/netbox/manage.py shell
```

**Inside Python shell, run:**
```python
from django.conf import settings
config = settings.PLUGINS_CONFIG.get('netbox_diode_plugin')
print(config)
```

**Expected output:**
```python
{
    'diode_target_override': 'grpc://192.168.1.20:8080/diode',
    'netbox_to_diode_client_secret': 'GdS63SRQ4I0G15I0V35uQYD7V+qnNUTjZCCD10yQvQ=',
    'hydra_admin_url': 'http://diode-hydra-1:4445'
}
```

**âœ… Verify `netbox_to_diode_client_secret` is NOT `None`**

**Exit Python shell:** `exit()`

---

**7. Test NetBox UI**

1. **Open browser:** `http://192.168.1.20:8000`
2. **Login** as admin
3. **Navigate to:** Plugins â†’ DIODE â†’ Client Credentials
4. **Click:** "+ Add a Credential"

**âœ… The error should be GONE!**

---

**ğŸ“‹ Complete Verification Checklist:**

```bash
# Run all these commands to verify everything:

# 1. Check DIODE credentials file exists
cat ~/netbox-discovery/diode/oauth2/client/client-credentials.json

# 2. Check Hydra has the client
cd ~/netbox-discovery/diode
docker-compose exec hydra hydra list clients --endpoint http://localhost:4445

# 3. Check NetBox plugin config syntax
cd ~/netbox-docker
grep -A 5 "netbox_diode_plugin" configuration/plugins.py

# 4. Verify NetBox can reach Hydra
docker-compose exec netbox curl http://diode-hydra-1:4445/health/ready
# Should return: {"status":"ok"}

# 5. Check NetBox logs for plugin errors
docker-compose logs netbox | grep -i diode | tail -20
```

---

**ğŸ¯ Quick Fix Summary:**

If you see the "Missing netbox to diode client secret" error:

```bash
# 1. Get the secret from DIODE
cd ~/netbox-discovery/diode
cat oauth2/client/client-credentials.json | grep -A 3 "netbox-to-diode"

# 2. Update NetBox config with CORRECT parameter name
cd ~/netbox-docker
nano configuration/plugins.py

# Make sure it says:
# 'netbox_to_diode_client_secret': 'YOUR_SECRET'
# NOT: 'diode_client_secret'

# And includes:
# 'hydra_admin_url': 'http://diode-hydra-1:4445'

# 3. Restart NetBox
docker-compose restart netbox netbox-worker

# 4. Wait 30 seconds and test
sleep 30
# Open browser and check Plugins > DIODE > Client Credentials
```

---

**Additional Notes:**

- The plugin expects the parameter name `netbox_to_diode_client_secret` (not `diode_client_secret`)
- The `hydra_admin_url` parameter is required for the plugin to manage OAuth clients
- Client ID is hardcoded as `netbox-to-diode` in the plugin - no need to specify it
- Ensure NetBox and DIODE containers are on the same Docker network for connectivity

**This configuration error is one of the most common issues during DIODE plugin setup. Following these exact steps will resolve it!**

</details>

<details>
<summary>Issue 2: Network Connectivity - "Could not resolve host"</summary>

**Solution:**
```bash
cd ~/netbox-discovery/diode
nano docker-compose.yml

# Add to bottom:
networks:
  default:
    external: true
    name: netbox-docker_default

# Restart
docker-compose down && docker-compose up -d
```

</details>

<details>
<summary>Issue 3: ORB Agent Config Not Found</summary>

**Solution:**
```bash
# Use absolute path in docker-compose.yml
volumes:
  - /home/username/netbox-discovery/orb-agent/config.yaml:/app/config.yaml

# Not relative path like:
# - ./config.yaml:/app/config.yaml
```

</details>

### ğŸ”— Resources

- [DIODE Quick Start Guide](https://github.com/netboxlabs/diode)
- [ORB Agent Documentation](https://github.com/netboxlabs/orb-agent)
- [NetBox DIODE Plugin](https://github.com/netboxlabs/netbox-diode-plugin)

---

## Video 10: pyATS + NetBox Integration

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=V_PmWxC2QDA)

### ğŸ“‹ Overview

Integrate Cisco pyATS testing framework with NetBox for automated network validation.

### ğŸ¯ What You'll Learn

- Install and configure pyATS
- Create testbed from NetBox data
- Run automated network tests
- Generate test reports

### ğŸ’» Commands

<details>
<summary>1. Install pyATS and Genie</summary>

```bash
# Activate virtual environment
source ~/ansible-venv/bin/activate

# Install pyATS
pip install pyats[full]

# Install Genie
pip install genie

# Verify installation
pyats version
genie --version
```

</details>

<details>
<summary>2. Create pyATS Testbed</summary>

```bash
# Create testbed directory
mkdir -p ~/pyats-netbox && cd ~/pyats-netbox

# Create testbed.yaml
cat << 'EOF' > testbed.yaml
testbed:
  name: Network_Lab
  credentials:
    default:
      username: cisco
      password: cisco

devices:
  vIOS-R1:
    os: ios
    type: router
    connections:
      cli:
        protocol: ssh
        ip: 192.168.1.10
        
  vIOS-R2:
    os: ios
    type: router
    connections:
      cli:
        protocol: ssh
        ip: 192.168.1.11
        
  vIOS-R3:
    os: ios
    type: router
    connections:
      cli:
        protocol: ssh
        ip: 192.168.1.12
EOF

# Verify testbed
pyats validate testbed testbed.yaml
```

</details>

<details>
<summary>3. Test Device Connectivity</summary>

```bash
# Connect to device
pyats shell --testbed-file testbed.yaml

# Inside pyATS shell
>>> devices.vIOS-R1.connect()
>>> devices.vIOS-R1.execute('show version')
>>> devices.vIOS-R1.disconnect()
>>> exit()
```

</details>

<details>
<summary>4. Parse Show Commands</summary>

```bash
# Create parser script
cat << 'EOF' > parse_devices.py
#!/usr/bin/env python3
from pyats import topology
from genie.conf import Genie

# Load testbed
testbed = topology.loader.load('testbed.yaml')

# Connect to device
device = testbed.devices['vIOS-R1']
device.connect()

# Parse show version
output = device.parse('show version')
print(f"Hostname: {output['version']['hostname']}")
print(f"Version: {output['version']['version']}")
print(f"Uptime: {output['version']['uptime']}")

# Parse show interfaces
interfaces = device.parse('show interfaces')
for intf in interfaces['interfaces']:
    print(f"Interface: {intf}")
    print(f"  Status: {interfaces['interfaces'][intf]['oper_status']}")

device.disconnect()
EOF

chmod +x parse_devices.py
python3 parse_devices.py
```

</details>

<details>
<summary>5. Learn Device Features</summary>

```bash
# Learn interface configuration
pyats learn interface --testbed testbed.yaml --device vIOS-R1 --output interface_state/

# Learn routing table
pyats learn routing --testbed testbed.yaml --device vIOS-R1 --output routing_state/

# Learn OSPF
pyats learn ospf --testbed testbed.yaml --device vIOS-R1 --output ospf_state/

# Learn all features
pyats learn all --testbed testbed.yaml --output all_features/
```

</details>

<details>
<summary>6. Create Test Script</summary>

```bash
# Create test script
cat << 'EOF' > test_network.py
#!/usr/bin/env python3
from pyats import aetest
from genie.testbed import load

class CommonSetup(aetest.CommonSetup):
    @aetest.subsection
    def connect_to_devices(self, testbed):
        for device in testbed.devices.values():
            device.connect()

class InterfaceTest(aetest.Testcase):
    @aetest.setup
    def setup(self, testbed):
        self.device = testbed.devices['vIOS-R1']
    
    @aetest.test
    def test_interfaces_up(self):
        output = self.device.parse('show interfaces')
        failed_interfaces = []
        
        for intf in output['interfaces']:
            status = output['interfaces'][intf]['oper_status']
            if status != 'up':
                failed_interfaces.append(intf)
        
        if failed_interfaces:
            self.failed(f"Interfaces down: {failed_interfaces}")
        else:
            self.passed("All interfaces are up")

class CommonCleanup(aetest.CommonCleanup):
    @aetest.subsection
    def disconnect_from_devices(self, testbed):
        for device in testbed.devices.values():
            device.disconnect()

if __name__ == '__main__':
    import argparse
    from pyats.topology import loader
    
    parser = argparse.ArgumentParser()
    parser.add_argument('--testbed', dest='testbed')
    args, unknown = parser.parse_known_args()
    
    testbed = loader.load(args.testbed)
    aetest.main(testbed=testbed)
EOF

chmod +x test_network.py
python3 test_network.py --testbed testbed.yaml
```

</details>

<details>
<summary>7. Compare Network States</summary>

```bash
# Learn "before" state
pyats learn interface --testbed testbed.yaml --output before/

# Make changes on devices...

# Learn "after" state
pyats learn interface --testbed testbed.yaml --output after/

# Compare states
pyats diff before/ after/
```

</details>

<details>
<summary>8. Integration with NetBox</summary>

```bash
# Create script to sync pyATS results to NetBox
cat << 'EOF' > sync_to_netbox.py
#!/usr/bin/env python3
import requests
import json
from pyats import topology

# NetBox configuration
NETBOX_URL = "http://192.168.1.120:8000"
NETBOX_TOKEN = "your-netbox-api-token"
headers = {
    "Authorization": f"Token {NETBOX_TOKEN}",
    "Content-Type": "application/json"
}

# Load testbed
testbed = topology.loader.load('testbed.yaml')

# Connect and collect data
device = testbed.devices['vIOS-R1']
device.connect()

# Parse interfaces
interfaces = device.parse('show interfaces')

# Update NetBox
for intf_name in interfaces['interfaces']:
    intf_data = interfaces['interfaces'][intf_name]
    
    # Create/update interface in NetBox
    data = {
        "name": intf_name,
        "type": "other",
        "enabled": intf_data['enabled'],
        "mtu": intf_data.get('mtu', 1500),
        "description": intf_data.get('description', '')
    }
    
    # API call to NetBox
    response = requests.post(
        f"{NETBOX_URL}/api/dcim/interfaces/",
        headers=headers,
        json=data
    )
    
    print(f"Updated interface: {intf_name} - Status: {response.status_code}")

device.disconnect()
EOF

chmod +x sync_to_netbox.py
python3 sync_to_netbox.py
```

</details>

<details>
<summary>9. Automated Testing with Job File</summary>

```bash
# Create job file
cat << 'EOF' > network_test_job.py
import os
from pyats.easypy import run

def main(runtime):
    """Main job execution"""
    
    # Run test script
    run(
        testscript='test_network.py',
        runtime=runtime,
        taskid='InterfaceTests'
    )
EOF

# Run job
pyats run job network_test_job.py --testbed-file testbed.yaml

# View results
# Results are in: ./archive/
ls -la archive/
```

</details>

### ğŸ”— Resources

- [pyATS Documentation](https://developer.cisco.com/docs/pyats/)
- [Genie Documentation](https://developer.cisco.com/docs/genie-docs/)
- [pyATS GitHub](https://github.com/CiscoTestAutomation/pyats)

---

## Video 11: MCP Fundamentals - Quick Breakdown

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=DDQL5OQDLJU)

### ğŸ“‹ Overview

Understanding Model Context Protocol (MCP) - the universal standard that connects AI assistants to external tools. This video covers theory and concepts only - hands-on setup is in Video 12.

### ğŸ¯ What You'll Learn

- What is MCP and why it matters
- MCP architecture (Host, Server, Resources)
- Transport methods (STDIO vs HTTP)
- FastMCP framework basics

### ğŸ—ï¸ MCP Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MCP ARCHITECTURE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       JSON-RPC       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚           â”‚                      â”‚   MCP SERVER    â”‚             â”‚
â”‚  â”‚  MCP HOST â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚             â”‚
â”‚  â”‚           â”‚    request/response  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    API      â”‚
â”‚  â”‚  Claude   â”‚                      â”‚  â”‚  TOOLS    â”‚  â”‚   calls     â”‚
â”‚  â”‚  Code     â”‚                      â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
â”‚  â”‚           â”‚                      â”‚  â”‚ â€¢ func1() â”‚  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚  â”‚ â€¢ func2() â”‚  â”‚             â”‚
â”‚                                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                            â”‚                         â”‚
â”‚                                            â–¼                         â”‚
â”‚                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                                     â”‚  RESOURCES  â”‚                  â”‚
â”‚                                     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                  â”‚
â”‚                                     â”‚ â€¢ APIs      â”‚                  â”‚
â”‚                                     â”‚ â€¢ Databases â”‚                  â”‚
â”‚                                     â”‚ â€¢ Files     â”‚                  â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š MCP Components

| Component | Description | Examples |
|-----------|-------------|----------|
| **MCP Host** | AI application interface | Claude Code, Claude Desktop, VS Code |
| **MCP Server** | Bridge between AI and tools | NetBox MCP, Custom servers |
| **Resources** | Actual data sources | APIs, Databases, Files |
| **Tools** | Functions AI can execute | get_devices(), get_ips() |

### ğŸ”„ Transport Methods

| Transport | Use Case | Pros | Cons |
|-----------|----------|------|------|
| **STDIO** | Local development | Simple, Secure, No ports | Same machine only |
| **HTTP/SSE** | Remote/Team | Multi-user, Docker-friendly | Network config needed |

### ğŸ“– Transport Decision Guide

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      SCENARIO           â”‚   USE      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Local development       â”‚   STDIO    â”‚
â”‚ Same machine            â”‚   STDIO    â”‚
â”‚ Remote server           â”‚   HTTP     â”‚
â”‚ Docker deployment       â”‚   HTTP     â”‚
â”‚ Team shared             â”‚   HTTP     â”‚
â”‚ Just starting? â­       â”‚   STDIO    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ Start with STDIO â†’ Graduate to HTTP
```

### ğŸ”— Resources

- [MCP Protocol Documentation](https://modelcontextprotocol.io/)
- [FastMCP Framework](https://gofastmcp.com)
- [Anthropic MCP Guide](https://docs.anthropic.com/en/docs/claude-code/mcp)

---

## Video 12: NetBox + MCP Hands-On Setup

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=YOUR_VIDEO_ID)

### ğŸ“‹ Overview

Complete hands-on guide to connect Claude AI to NetBox using Model Context Protocol (MCP) for natural language infrastructure queries.

### ğŸ¯ What You'll Learn

- Install Claude Code CLI on Linux
- Setup UV Python package manager
- Clone and configure NetBox MCP Server
- Create NetBox API token
- Query NetBox using natural language

### ğŸ—ï¸ Lab Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LAB TOPOLOGY                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚  Ansible Node   â”‚            â”‚     NetBox      â”‚               â”‚
â”‚   â”‚  (Claude Host)  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  192.168.1.20   â”‚               â”‚
â”‚   â”‚                 â”‚    API     â”‚                 â”‚               â”‚
â”‚   â”‚ â€¢ Claude Code   â”‚            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚
â”‚   â”‚ â€¢ NetBox MCP    â”‚            â”‚  â”‚ 3 Devices â”‚  â”‚               â”‚
â”‚   â”‚ â€¢ UV / Python   â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                     â”‚
â”‚   Devices in NetBox:                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚   â”‚ vIOS-R1 â”‚   â”‚ vIOS-R2 â”‚   â”‚ vIOS-R3 â”‚                          â”‚
â”‚   â”‚  .201   â”‚   â”‚  .202   â”‚   â”‚  .203   â”‚                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                     â”‚
â”‚   âš ï¸ Note: Actual routers NOT required for MCP queries!            â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“– Key Concepts

| Term | Description |
|------|-------------|
| **Node.js** | JavaScript runtime for running CLI tools like Claude Code |
| **NPM** | Node Package Manager - like pip for JavaScript packages |
| **Claude Code** | CLI interface for Claude AI (Linux option) |
| **Claude Desktop** | GUI application (Windows/macOS only - no Linux) |
| **UV** | Fast Python package manager built in Rust (10-100x faster than pip) |
| **MCP Host** | Where the AI runs (Claude Code in our case) |
| **MCP Server** | Bridge that translates AI requests to API calls |
| **Tools** | Functions the AI can call (e.g., netbox_get_objects) |
| **Pontification** | Claude's "thinking out loud" reasoning process |
| **DCIM** | Data Center Infrastructure Management (devices, racks, sites) |
| **IPAM** | IP Address Management (IPs, prefixes, VLANs) |

### ğŸ’» Commands

<details>
<summary>1. Install Node.js 20+</summary>

```bash
# Check if Node.js is installed
node --version

# If not installed, add NodeSource repository
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -

# Install Node.js
sudo apt install -y nodejs

# Verify installation
node --version    # Should show v20.x.x
npm --version     # Should show 10.x.x
```

**What is Node.js?** JavaScript runtime that lets you run JavaScript outside a browser. Many modern CLI tools are built with it.

**What is NPM?** Node Package Manager - like pip for Python or apt for Ubuntu.

</details>

<details>
<summary>2. Install Claude Code CLI</summary>

```bash
# Install Claude Code globally
sudo npm install -g @anthropic-ai/claude-code

# Verify installation
claude --version

# Check available commands
claude --help
```

**Claude Offerings:**
| Option | Platform | Description |
|--------|----------|-------------|
| Claude.ai | Web | Browser-based interface |
| Claude Desktop | Windows/macOS | GUI application (No Linux!) |
| Claude Code | All platforms | CLI interface â† Our choice for Linux |

</details>

<details>
<summary>3. Install UV (Python Package Manager)</summary>

```bash
# Install UV
curl -LsSf https://astral.sh/uv/install.sh | sh

# Add to PATH (current session)
source $HOME/.local/bin/env

# Add to PATH permanently
echo 'source $HOME/.local/bin/env' >> ~/.bashrc
source ~/.bashrc

# Verify installation
uv --version
```

**Why UV?** 10-100x faster than pip, automatically creates virtual environments, handles all dependency resolution.

</details>

<details>
<summary>4. Clone NetBox MCP Server</summary>

```bash
# Create MCP servers directory
mkdir -p ~/mcp-servers
cd ~/mcp-servers

# Clone official NetBox MCP server from NetBox Labs
# Find at: NetBox Labs Docs > MCP Section > GitHub Repository
git clone https://github.com/netboxlabs/netbox-mcp-server.git

# Verify clone
ls -l

# Enter the directory
cd netbox-mcp-server

# View contents
ls -la
```

</details>

<details>
<summary>5. Create NetBox API Token</summary>

```bash
# In NetBox UI:
# 1. Login to NetBox: http://192.168.1.20:8000
# 2. Click your username (top right corner)
# 3. Select "API Tokens"
# 4. Click "+ Add a token"
# 5. Description: "mcp-setup"
# 6. Write enabled: Leave UNCHECKED (read-only is safer)
# 7. Click "Create"
# 8. COPY THE TOKEN IMMEDIATELY - shown only once!
```

</details>

<details>
<summary>6. Test MCP Server Standalone</summary>

```bash
# Navigate to MCP server directory
cd ~/mcp-servers/netbox-mcp-server

# Test MCP server connection (replace with your values)
NETBOX_URL=http://192.168.1.20:8000/ \
NETBOX_TOKEN=your-netbox-api-token \
uv run netbox-mcp-server

# What happens behind the scenes:
# 1. UV creates virtual environment (.venv folder)
# 2. Reads dependencies from pyproject.toml
# 3. Downloads packages (FastMCP, httpx, pydantic, etc.)
# 4. Runs the MCP server

# You should see:
# - FastMCP banner
# - Server name: NetBox
# - Message: "Starting MCP server 'NetBox' with transport 'stdio'"

# Press Ctrl+C to stop the server
```

**What does this prove?** MCP server can connect to NetBox API and is functioning correctly - but running standalone, not connected to Claude yet.

</details>

<details>
<summary>7. Configure Claude Code with MCP Server</summary>

```bash
# Register MCP server with Claude Code
claude mcp add netbox \
  -e NETBOX_URL=http://192.168.1.20:8000/ \
  -e NETBOX_TOKEN=your-netbox-api-token \
  -- uv --directory ~/mcp-servers/netbox-mcp-server run netbox-mcp-server

# Command breakdown:
# claude mcp add netbox     â†’ Add server named "netbox"
# -e NETBOX_URL=...         â†’ Environment variable for URL
# -e NETBOX_TOKEN=...       â†’ Environment variable for token
# -- uv --directory ... run â†’ Command to start the server

# Verify MCP server is registered
claude mcp list

# You should see:
# "Checking MCP server health..."
# "netbox âœ“ Connected"
```

**Difference between Step 6 and Step 7:**
| Step 6 | Step 7 |
|--------|--------|
| Manual standalone test | Register with Claude Code |
| We run the server | Claude manages the server |
| Verify it works | Enable Claude to use it |

</details>

<details>
<summary>8. Start Claude Code</summary>

```bash
# Launch Claude Code
claude

# First-time setup:
# 1. Choose text editor style (6 options) - pick default
# 2. Select login method:
#    - Claude Subscription (Pro/Max) â† Recommended
#    - API Usage (pay per token)
# 3. Browser opens for authentication
# 4. Login and authorize
# 5. Press Enter to continue
# 6. Configure terminal settings (use default)

# Welcome screen shows:
# - Subscription details
# - Model: Claude Opus 4.5
# - Available MCP servers including "netbox"
```

**Login Options:**
| Option | Description | Pricing |
|--------|-------------|---------|
| Claude Subscription | Pro/Max monthly | Fixed monthly fee |
| API Usage | Pay per token | See anthropic.com/pricing |

</details>

<details>
<summary>9. Demo Queries</summary>

```bash
# Inside Claude Code, try these natural language queries:

# Query 1: List all devices
List all devices in my NetBox
# Triggers: netbox_get_objects tool
# Returns: Device ID, Name, Status, Type, Site, Primary IP

# Query 2: Site and role query
Show all devices from Main-DC with their role
# May show "Pontification" (Claude thinking out loud)

# Query 3: IP address query (IPAM)
List all IP addresses assigned to each device
# Queries ipam.ipaddresses object

# Query 4: MAC address query
List all MAC addresses available in NetBox
# Returns: MAC addresses for each interface
```

</details>

<details>
<summary>10. MCP Server Management</summary>

```bash
# List all registered MCP servers
claude mcp list

# Remove an MCP server
claude mcp remove netbox

# Re-add with different settings
claude mcp add netbox \
  -e NETBOX_URL=http://new-ip:8000/ \
  -e NETBOX_TOKEN=new-token \
  -- uv --directory ~/mcp-servers/netbox-mcp-server run netbox-mcp-server

# View MCP server configuration
cat ~/.config/claude-code/mcp.json
```

</details>

<details>
<summary>11. Troubleshooting</summary>

```bash
# If UV times out during package install
UV_HTTP_TIMEOUT=120 uv sync

# If MCP server won't start - reset virtual environment
cd ~/mcp-servers/netbox-mcp-server
rm -rf .venv
uv sync

# If Claude can't connect to MCP server
claude mcp list
# Check for red X marks or "Disconnected" status

# Verify NetBox API is accessible
curl -s http://192.168.1.20:8000/api/ \
  -H "Authorization: Token YOUR_TOKEN" | head -20

# Debug MCP server with logging
NETBOX_URL=http://192.168.1.20:8000/ \
NETBOX_TOKEN=your-token \
uv run netbox-mcp-server 2>&1 | tee mcp-debug.log
```

</details>

### ğŸ¯ Demo Queries Reference

| Query | Tool Called | Data Returned |
|-------|-------------|---------------|
| "List all devices" | netbox_get_objects | Device ID, Name, Status, Type, Site, IP |
| "Show devices from Main-DC with role" | netbox_get_objects | Devices filtered by site with roles |
| "List all IP addresses" | netbox_get_objects (ipam) | IPs, interfaces, assignment status |
| "List all MAC addresses" | netbox_get_objects | MAC addresses per interface |

### âš ï¸ Important Notes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     IMPORTANT NOTES                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  âœ… READ-ONLY ACCESS                                             â”‚
â”‚     NetBox MCP server only queries data                          â”‚
â”‚     It CANNOT modify your NetBox                                 â”‚
â”‚     Safe for production environments                             â”‚
â”‚                                                                  â”‚
â”‚  âŒ NO SSH TO DEVICES                                            â”‚
â”‚     We're querying NetBox (source of truth)                      â”‚
â”‚     NOT the actual network devices                               â”‚
â”‚     For device access â†’ Video 13: Custom MCP Server              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”— Resources

- [NetBox MCP Server GitHub](https://github.com/netboxlabs/netbox-mcp-server)
- [NetBox Labs Documentation](https://netboxlabs.com/docs/)
- [Claude Code Download](https://claude.ai/download)
- [Anthropic Pricing](https://anthropic.com/pricing)
- [UV Package Manager](https://astral.sh/uv)
- [FastMCP Documentation](https://gofastmcp.com)
- [MCP Protocol](https://modelcontextprotocol.io/)

---

## Video 13: Custom MCP Server - Network Device Automation

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=vtDuhAP-KfQ)

### ğŸ“‹ Overview

Build a custom MCP server using FastMCP and Netmiko to SSH into network devices and run commands via Claude CLI.

### ğŸ¯ What You'll Build

- Custom Python MCP server with FastMCP
- SSH connectivity using Netmiko
- Device inventory from YAML file
- Natural language to Live device commands

### ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    STDIO    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   SSH   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Claude CLI     â”‚<----------->â”‚  device_mcp.py     â”‚<------->â”‚  Routers  â”‚   â”‚
â”‚   â”‚                 â”‚             â”‚                    â”‚         â”‚           â”‚   â”‚
â”‚   â”‚  "Show          â”‚             â”‚  Python            â”‚         â”‚  vIOS-R1  â”‚   â”‚
â”‚   â”‚   version on    â”‚             â”‚  FastMCP           â”‚         â”‚  vIOS-R2  â”‚   â”‚
â”‚   â”‚   R1"           â”‚             â”‚  Netmiko           â”‚         â”‚  vIOS-R3  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                            ^                                      â”‚
â”‚                                       devices.yaml                                â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ’» Commands

<details>
<summary>1. Project Setup</summary>

```bash
# Navigate to MCP servers directory
cd ~/mcp-servers

# Create project directory
mkdir device-mcp
cd device-mcp

# Initialize Python project with UV
uv init

# Add dependencies
uv add fastmcp netmiko pyyaml

# Verify installation
uv pip list | grep -E "fastmcp|netmiko"
```

</details>

<details>
<summary>2. devices.yaml - Device Inventory</summary>

```yaml
vIOS-R1:
  host: 192.168.1.101
  
vIOS-R2:
  host: 192.168.1.102
  
vIOS-R3:
  host: 192.168.1.103
```

</details>

<details>
<summary>3. device_mcp.py - Custom MCP Server</summary>

```python
#!/usr/bin/env python3
from fastmcp import FastMCP
from netmiko import ConnectHandler
import yaml

# Initialize MCP server
mcp = FastMCP("DeviceCommands")

# Credentials (for demo - use env vars in production)
CREDENTIALS = {
    "username": "ansible",
    "password": "ansible@123",
    "device_type": "cisco_ios"
}

# Load device inventory
def load_inventory(path: str = "devices.yaml"):
    with open(path, "r") as f:
        return yaml.safe_load(f)

DEVICES = load_inventory()

@mcp.tool()
def list_devices() -> str:
    """List all available network devices"""
    return "\n".join(DEVICES.keys())

@mcp.tool()
def run_command(device_name: str, command: str) -> str:
    """Run a show command on a network device via SSH.
    
    Args:
        device_name: Name of the device (e.g., vIOS-R1)
        command: The show command to run
    """
    if device_name not in DEVICES:
        return f"Error: Device {device_name} not found"
    
    device_info = DEVICES[device_name]
    connection_params = {
        "host": device_info["host"],
        **CREDENTIALS
    }
    
    try:
        with ConnectHandler(**connection_params) as conn:
            output = conn.send_command(command)
            return output
    except Exception as e:
        return f"Error: {str(e)}"

@mcp.tool()
def get_device_info(device_name: str) -> dict:
    """Get connection info for a device"""
    if device_name not in DEVICES:
        return {"error": f"Device {device_name} not found"}
    return DEVICES[device_name]

if __name__ == "__main__":
    mcp.run()
```

</details>

<details>
<summary>4. Test MCP Server Locally</summary>

```bash
# Test the server runs without errors
uv run python device_mcp.py

# You should see FastMCP banner with "DeviceCommands"
# Press Ctrl+C to stop
```

</details>

<details>
<summary>5. Register MCP Server with Claude CLI</summary>

```bash
# Add MCP server to Claude CLI
claude mcp add device-commands -- uv --directory ~/mcp-servers/device-mcp run python device_mcp.py

# Verify registration
claude mcp list

# Expected output shows device-commands as connected
```

</details>

<details>
<summary>6. Launch Claude CLI and Test</summary>

```bash
# Start Claude CLI
claude

# Demo Query 1: List devices
"List the available devices"

# Demo Query 2: Show version
"Show me the IOS version on vIOS-R1"

# Demo Query 3: Interface info
"What interfaces are configured on vIOS-R2?"

# Demo Query 4: Multi-device query
"Show the routing table on all three routers"
```

</details>

<details>
<summary>7. MCP Server Management</summary>

```bash
# List all registered MCP servers
claude mcp list

# Remove an MCP server
claude mcp remove device-commands

# Re-add with different path
claude mcp add device-commands -- uv --directory /new/path run python device_mcp.py

# View MCP logs (for troubleshooting)
# Check ~/.claude/mcp-logs/
```

</details>

### ğŸ“¦ Example Queries

```bash
# List available devices
"What devices can you connect to?"

# Run show commands
"Show the version on vIOS-R1"
"What interfaces are on vIOS-R2?"
"Show me the routing table on vIOS-R3"

# Multi-device queries
"Show version on all routers"
"Check OSPF neighbors on R1 and R2"
"Compare the interface status across all routers"
```

### ğŸ”— Resources

- [FastMCP Documentation](https://gofastmcp.com)
- [Netmiko GitHub](https://github.com/ktbyers/netmiko)
- [Claude CLI Download](https://claude.ai/download)

---

## Video 14: Ansible Dynamic Inventory with NetBox

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=vtDuhAP-KfQ)

### ğŸ“‹ Overview

Configure Ansible to pull device inventory directly from NetBox instead of static files. Add a device in NetBox and it automatically available in Ansible. No more manual inventory updates!

### ğŸ¯ What You'll Learn

- How dynamic inventory actually works
- Setting up the NetBox Ansible plugin
- Auto-grouping devices by role, site, and platform
- And running playbooks against this live inventory"
- Troubleshoot common issues (including Redis Docker bug)

### ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚   STATIC INVENTORY (Old Way)              DYNAMIC INVENTORY (New Way)             â”‚
â”‚   --------------------------              ---------------------------             â”‚
â”‚                                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚   â”‚ inventory/hosts      â”‚                â”‚     NetBox      â”‚                     â”‚
â”‚   â”‚                      â”‚                â”‚   (Source of    â”‚                     â”‚
â”‚   â”‚ [routers]            â”‚                â”‚     Truth)      â”‚                     â”‚
â”‚   â”‚ R1 ansible_host=...  â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚   â”‚ R2 ansible_host=...  â”‚                         â”‚                              â”‚
â”‚   â”‚ R3 ansible_host=...  â”‚                         â”‚ API Call                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         v                              â”‚
â”‚              â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚              â”‚                            â”‚  netbox.yml     â”‚                     â”‚
â”‚              v                            â”‚  (Plugin Config)â”‚                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚   â”‚      Ansible         â”‚                         â”‚                              â”‚
â”‚   â”‚    (Runs Playbook)   â”‚<------------------------+                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                                   â”‚
â”‚   [X] Manual updates required             [OK] Always current                     â”‚
â”‚   [X] Config drift risk                   [OK] Single source of truth             â”‚
â”‚   [X] Duplicate effort                    [OK] Auto-grouping by role/site         â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”„ How Dynamic Inventory Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚   â”‚  $ ansible-inventory --graph        â”‚  <-- You run this command               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                      â”‚                                                            â”‚
â”‚                      v                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚   â”‚  Ansible reads: inventory/netbox.ymlâ”‚  <-- Plugin config file                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                      â”‚                                                            â”‚
â”‚                      v                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚   â”‚  GET /api/dcim/devices/             â”‚  <-- Auto API call to NetBox            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                      â”‚                                                            â”‚
â”‚                      v                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚   â”‚  NetBox returns: Device list (JSON) â”‚  <-- Real-time device data              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                      â”‚                                                            â”‚
â”‚                      v                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚   â”‚  @all:                              â”‚                                         â”‚
â”‚   â”‚    |--@device_roles_router:         â”‚  <-- Dynamic inventory graph            â”‚
â”‚   â”‚    |  |--vIOS-R1                    â”‚                                         â”‚
â”‚   â”‚    |  |--vIOS-R2                    â”‚                                         â”‚
â”‚   â”‚    |  |--vIOS-R3                    â”‚                                         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Concept:** The `netbox.yml` file is NOT the inventory itself - it's the CONFIG that tells Ansible HOW to get inventory from NetBox. Every time you run an Ansible command, it queries NetBox in real-time!

### ğŸ“‹ Dynamic Inventory Structure

This section contains the JSON schema used by our dynamic inventory scripts. Click the arrows below to expand each section.

#### 1. ğŸ” Host Metadata (_meta)
Contains individual device details like **Serial Numbers**, **Manufacturer**, and **Hardware Roles**.

<details>
<summary>â–¶ Click to expand Host Variables</summary>

```json
{
  "_meta": {
    "hostvars": {
      "spine-01.dc1": {
        "ansible_host": "10.10.1.1",
        "serial_number": "SN-CISCO-123",
        "manufacturer": "Cisco",
        "model": "Nexus 9300",
        "site": "Chicago-DC",
        "device_role": "spine"
      },
      "leaf-01.dc1": {
        "ansible_host": "10.10.2.1",
        "serial_number": "SN-ARISTA-999",
        "manufacturer": "Arista",
        "model": "DCS-7050",
        "site": "Chicago-DC",
        "device_role": "leaf"
      }
    }
  }
}
```
</details>

#### ğŸ—ï¸ 2. Group Definitions
These groups allow you to target devices based on their function, location, or OS platform. Each group contains its own specific variables.

<details>
<summary>â–¶ Click to expand Group Definitions (Roles, Sites, Platforms)</summary>

```json
{
  "role_spine": {
    "hosts": ["spine-01.dc1"]
  },
  "role_leaf": {
    "hosts": ["leaf-01.dc1"]
  },
  "site_chicago": {
    "hosts": ["spine-01.dc1", "leaf-01.dc1"],
    "vars": {
      "ntp_server": "10.0.0.5",
      "timezone": "CST",
      "dns_primary": "8.8.8.8"
    }
  },
  "platform_ios": {
    "hosts": ["spine-01.dc1"],
    "vars": {
      "ansible_network_os": "cisco.ios.ios"
    }
  },
  "platform_eos": {
    "hosts": ["leaf-01.dc1"],
    "vars": {
      "ansible_network_os": "arista.eos.eos"
    }
  }
}
```
</details>

#### ğŸŒ 3. Global Hierarchy (all)
This is the "Parent" group. It lists all other groups as children and sets the global variables used for the entire fleet.

<details> <summary>â–¶ Click to expand Global Hierarchy & Connection Vars</summary>

```json
{
  "all": {
    "children": [
      "role_spine",
      "role_leaf",
      "site_chicago",
      "platform_ios",
      "platform_eos"
    ],
    "vars": {
      "ansible_connection": "ansible.netcommon.network_cli",
      "ansible_user": "netadmin",
      "ansible_become": true,
      "ansible_become_method": "enable"
    }
  }
}
```
</details>



### ğŸ  Home LAB Demo Setup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                      â”‚   Fortinet    â”‚         â”‚   NetBox-SOT    â”‚                â”‚
â”‚                      â”‚   Firewall    â”‚         â”‚  (Inventory Src)â”‚                â”‚
â”‚                      â”‚ 192.168.1.211 â”‚         â”‚  192.168.1.120  â”‚                â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                              â”‚ port1                    â”‚ e0                      â”‚
â”‚                              â”‚                          â”‚                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   Net   â”‚---------â”‚              Mgmt_Switch               â”‚---â”‚  Ansible  â”‚  â”‚
â”‚   â”‚ (Cloud) â”‚  Gi0/3  â”‚                                        â”‚   â”‚   Node    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚192.168.1. â”‚  â”‚
â”‚                             â”‚Gi0/0        â”‚Gi0/1        â”‚Gi0/2     â”‚    119    â”‚  â”‚
â”‚                             â”‚             â”‚             â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                    â”‚
â”‚                        â”‚ vIOS-R1 â”‚---â”‚ vIOS-R2 â”‚---â”‚ vIOS-R3 â”‚                    â”‚
â”‚                        â”‚  Router â”‚   â”‚  Router â”‚   â”‚  Router â”‚                    â”‚
â”‚                        â”‚ 192.168 â”‚   â”‚ 192.168 â”‚   â”‚ 192.168 â”‚                    â”‚
â”‚                        â”‚  .1.101 â”‚   â”‚  .1.102 â”‚   â”‚  .1.103 â”‚                    â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ COMPONENTS                                                                â”‚   â”‚
â”‚   â”‚ > NetBox-SOT (192.168.1.120) --- Source of Truth / Inventory Source       â”‚   â”‚
â”‚   â”‚ > Ansible Node (192.168.1.119) - Runs playbooks with dynamic inventory    â”‚   â”‚
â”‚   â”‚ > vIOS-R1/R2/R3 ---------------- Target network devices                   â”‚   â”‚
â”‚   â”‚ > Fortinet Firewall ------------ Additional managed device                â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“‹ Prerequisites

| Requirement | Details |
|-------------|---------|
| NetBox | Running with devices configured |
| Devices | Primary IP assigned, Status = Active |
| Platform | Set for each device |
| API Token | NetBox API token ready |
| Ansible | Installed in virtual environment |

### ğŸ’» Commands

<details>
<summary>1. Verify NetBox is Running</summary>

```bash
# Access NetBox via VS Code Remote SSH or terminal
# Start NetBox Docker if not running
cd ~/netbox-docker
docker-compose up -d

# Test NetBox is accessible
curl -I http://192.168.1.20:8000
# Expected: HTTP/1.1 302 Found

# Test API with your token
curl -s -H "Authorization: Token YOUR_NETBOX_TOKEN" \
  http://192.168.1.20:8000/api/dcim/devices/ | jq

# This returns full device details including:
# - Device names (vIOS-R1, vIOS-R2, vIOS-R3)
# - Primary IPs (192.168.1.101, .102, .103)
# - Device roles, platforms, sites
# - Status (active)
```

</details>

<details>
<summary>2. Prepare Ansible Environment</summary>

```bash
# Activate your ansible virtual environment
netdev

# Check our project
ls -l
cd ~/ansible-project

# Look at current static inventory
cat ./inventory/hosts

# Backup old inventory
mv ./inventory/hosts ./inventory/hosts_backup
ls -l ./inventory/

# Verify backup created
ls -l ./inventory/
# hosts.backup should now exist
```

</details>

<details>
<summary>3. Install NetBox Ansible Collection</summary>

```bash
# Check if Netbox Plugin avaliable on Virtiual Enviorment
ansible-galaxy collection list | grep netbox

"Nothing installed. Let's get the latest version."

# If exist, remove them if its older version ( current Plugin Version is 3.22)
rm -rf ~/.ansible/collections/ansible_collections/netbox/netbox
rm -rf ~/ansible-project/ansible-venv/lib/python3.10/site-packages/ansible_collections/netbox/netbox

# Install NetBox collection
ansible-galaxy collection install netbox.netbox

# If already installed, force update to latest
ansible-galaxy collection install netbox.netbox --force

# Verify installation
ansible-galaxy collection list | grep netbox
# Expected: netbox.netbox  3.20.0 (or newer)

# Verify plugin exists
ansible-doc -t inventory netbox.netbox.nb_inventory

# Install required Python dependency
pip install pytz
pip install ansible-pylibssh

# Verify pytz installed
pip show pytz
# Expected: Version: 2025.x
pip show ansible-pylibssh




```

</details>

<details>
<summary>4. Create NetBox Inventory File</summary>

```bash
# Create the inventory file
code ./inventory/netbox.yml
```

**inventory/netbox.yml:**
```yaml
---
plugin: netbox.netbox.nb_inventory

# NetBox connection settings
api_endpoint: http://192.168.1.20:8000
token: YOUR_NETBOX_TOKEN_HERE
validate_certs: false

# Group devices automatically by these attributes
group_by:
  - device_roles    # Creates groups like: device_roles_router
  - platforms       # Creates groups like: platforms_cisco_ios
  - sites           # Creates groups like: sites_main_dc
  - tags            # Creates groups based on device tags

# Only fetch active devices
query_filters:
  - status: active

# Map NetBox fields to Ansible variables
compose:
  # Extract IP without subnet mask (192.168.1.101/24 -> 192.168.1.101)
  ansible_host: primary_ip4.address | split('/') | first
  # Use platform slug for network_os ( Jinja modify the os details based platfrom info from Netbox, all automatic)
  ansible_network_os: platform.name | regex_replace('.*IOS.*', 'cisco.ios.ios', ignorecase=True) | default('unknown')

# Only include devices that have a primary IP assigned
device_query_filters:
  - has_primary_ip: true
```

**Configuration Breakdown:**

| Setting | Purpose |
|---------|---------|
| `plugin` | Tells Ansible to use NetBox inventory plugin |
| `api_endpoint` | Your NetBox server URL |
| `token` | API authentication token |
| `validate_certs` | Skip SSL verification (for lab) |
| `group_by` | Auto-create groups from device attributes |
| `query_filters` | Only fetch devices with status=active |
| `compose` | Transform NetBox data into Ansible variables |
| `device_query_filters` | Only devices with IP addresses |

</details>

<details>
<summary>5. Update ansible.cfg</summary>

```bash
# Edit ansible configuration
code ./ansible.cfg
```

**Change inventory path:**
```ini
[defaults]
# OLD: inventory = inventory/hosts
inventory = inventory/netbox.yml    # NEW: Point to NetBox plugin
host_key_checking = False
timeout = 30
```

</details>


<details>
<summary>6. Test Dynamic Inventory</summary>

```bash
# View inventory as a tree graph
ansible-inventory --graph

# Expected output:
# @all:
#   |--@ungrouped:
#   |--@sites_main_dc:
#   |  |--vIOS-R1
#   |  |--vIOS-R2
#   |  |--vIOS-R3
#   |--@device_roles_router:
#   |  |--vIOS-R1
#   |  |--vIOS-R2
#   |  |--vIOS-R3
#   |--@platforms_cisco_ios:
#   |  |--vIOS-R1
#   |  |--vIOS-R2
#   |  |--vIOS-R3

# View full inventory as JSON
ansible-inventory --list

# Check variables for specific host
ansible-inventory --host vIOS-R1
ansible-inventory -i inventory/netbox.yml --host vIOS-R1 --vars --yaml

```

</details>

<details>
<summary>7. Run Playbook with Dynamic Inventory</summary>

```bash
# Create test playbook
cat << 'EOF' > playbooks/show_version.yml
---
- name: IOS Version Report
  hosts: all
  gather_facts: no
  vars:
    ansible_user: ansible
    ansible_ssh_password: ansible@123

  tasks:
    - name: Get version
      raw: show version

      register: version

    - name: Show version
      debug:
        msg: "{{ inventory_hostname }}: {{ (version.stdout_lines | select('match', '.*IOS.*') | first) }}"
EOF

# Run on all devices
ansible-playbook playbooks/show_version.yml

# Run on specific group (by device role)
ansible-playbook playbooks/show_version.yml --limit device_roles_router

# Run on specific site
ansible-playbook playbooks/show_version.yml --limit sites_main_dc

# Run on single device
ansible-playbook playbooks/show_version.yml --limit vIOS-R1
```

</details>

<details>
<summary>8. Demo: Add Device in NetBox -> Auto Appears in Ansible</summary>

```bash
# THE MAGIC OF DYNAMIC INVENTORY:

# Step 1: Check current inventory
ansible-inventory --graph
# Shows: vIOS-R1, vIOS-R2, vIOS-R3

# Step 2: Add new device in NetBox UI
# - Go to NetBox -> Devices -> Add
# - Name: vIOS-R4
# - Assign Primary IP
# - Set Status = Active
# - Set Device Role = Router
# - Set Platform = cisco-ios

# Step 3: Run inventory again (NO FILE CHANGES NEEDED!)
ansible-inventory --graph

# Step 4: New device appears automatically!
# @all:
#   |--@device_roles_router:
#   |  |--vIOS-R1
#   |  |--vIOS-R2
#   |  |--vIOS-R3
#   |  |--vIOS-R4  <-- NEW DEVICE!

# Step 5: Run playbook - includes new device
ansible-playbook playbooks/show_version.yml
```

</details>

### âš ï¸ Troubleshooting

<details>
<summary>Redis Connection Error (NetBox Docker 4.4.5+)</summary>

**Error Message:**
```
[WARNING]: Failed to parse inventory/netbox.yml with auto plugin: 
{"error": "Error -3 connecting to redis:6379. Temporary failure in name resolution.", 
"exception": "ConnectionError", "netbox_version": "4.4.5-Docker-3.4.1", "python_version": "3.12.3"}
```

**Root Cause Analysis:**

| Step | What Happens |
|------|--------------|
| 1 | NetBox Docker exposes `/api/status/` endpoint |
| 2 | Ansible plugin calls `self._fetch_information(api_endpoint + "/api/status/")` |
| 3 | Response contains: `"netbox-version": "4.4.5-Docker-3.4.1"` |
| 4 | Plugin detects "Docker" in version string |
| 5 | Plugin tries internal Redis probe to `redis:6379` |
| 6 | Your Ansible host can't resolve "redis" (Docker-internal hostname) |
| 7 | **Plugin CRASHES** before `cache: false` or `group_by` config loads |

**The Fix - Modify NetBox Inventory Plugin:**

```bash
# Find the plugin file location
find ~/.ansible -name "nb_inventory.py" 2>/dev/null

# Typical location:
# ~/.ansible/collections/ansible_collections/netbox/netbox/plugins/inventory/nb_inventory.py

# Edit the file
code ~/.ansible/collections/ansible_collections/netbox/netbox/plugins/inventory/nb_inventory.py
```

**Replace the `_fetch_information` call with a direct mock:**

Find the section that calls `_fetch_information` for status and replace with:

```python
# ORIGINAL CODE (causes Redis error):
# status = self._fetch_information(self.api_endpoint + "/api/status/")

# FIXED CODE (bypasses Redis probe):
status = {
    "netbox-version": "4.4.5",
    "netbox-version-docker": "3.4.1", 
    "python-version": "3.12.3"
}
netbox_api_version = "4.4"
```

**Result After Fix:**

```bash
ansible-inventory --graph
# [WARNING]: Invalid characters were found in group names but not replaced
# [WARNING]: Unable to load the facts cache plugin ().
# @all:
#   |--@ungrouped:
#   |--@sites_main_dc:
#   |  |--vIOS-R1
#   |  |--vIOS-R2
#   |  |--vIOS-R3
#   |--@device_roles_router:
#   |  |--vIOS-R1
#   |  |--vIOS-R2
#   |  |--vIOS-R3
#   |--@platforms_ios_iosv_software...:
#   |  |--vIOS-R1
#   |  |--vIOS-R2
#   |  |--vIOS-R3
```

- Bypasses Redis probe entirely  
- Sets correct NetBox version (4.4) for schema selection  
- `group_by`, `compose`, and all config options work perfectly

</details>

<details>
<summary>No Hosts Found</summary>

```bash
# Check 1: Devices have Primary IP in NetBox
# Go to NetBox -> Devices -> Check "Primary IPv4" column

# Check 2: Devices Status = Active
# Go to NetBox -> Devices -> Check "Status" column

# Check 3: Test API directly
curl -s -H "Authorization: Token YOUR_TOKEN" \
  http://192.168.1.20:8000/api/dcim/devices/ | jq '.results[].name'
```

</details>

<details>
<summary>Authentication Failed</summary>

```bash
# Verify group_vars/all.yml has correct credentials
cat group_vars/all.yml

# Test SSH manually
ssh ansible@192.168.1.101
# Password: ansible@123
```

</details>

<details>
<summary>Plugin Not Found</summary>

```bash
# Reinstall NetBox collection
ansible-galaxy collection install netbox.netbox --force

# Verify installation
ansible-galaxy collection list | grep netbox
```

</details>

### ğŸ“ Final Project Structure

```
ansible-project/
â”œâ”€â”€ ansible.cfg                    # Updated: inventory = inventory/netbox.yml
â”œâ”€â”€ inventory/
â”‚   â”œâ”€â”€ hosts.backup              # Old static inventory (backup)
â”‚   â””â”€â”€ netbox.yml                # NEW: Dynamic inventory config
â”œâ”€â”€ group_vars/
â”‚   â””â”€â”€ all.yml                   # Connection credentials
â”œâ”€â”€ playbooks/
â”‚   â”œâ”€â”€ show_version.yml
â”‚   â””â”€â”€ backup_configs.yml
â””â”€â”€ backups/                      # Created by backup playbook
```

### ğŸ”— Resources

- [NetBox Ansible Collection](https://galaxy.ansible.com/netbox/netbox)
- [NetBox Inventory Plugin Docs](https://netbox-ansible-collection.readthedocs.io/)
- [NetBox API Documentation](https://demo.netbox.dev/api/docs/)

---


## Video 15: Ansible MCP Integration

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=rN9GJgPKeCQ)

### ğŸ“‹ Overview

Integrate MCP with Ansible to trigger playbooks via natural language using Claude CLI.

### ğŸ¯ What You'll Learn

- Build MCP server that runs Ansible playbooks
- Natural language to Ansible automation
- Integration with NetBox dynamic inventory

### ğŸ—ï¸ Architecture

```
                         "Backup all routers"
                                  â”‚
                                  â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   Claude CLI    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚ MCP Protocol
                                 â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Ansible MCP    â”‚
                        â”‚    Server       â”‚
                        â”‚                 â”‚
                        â”‚ - list_playbooksâ”‚
                        â”‚ - run_playbook  â”‚
                        â”‚ - get_inventory â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                  â–¼                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ backup.yml â”‚    â”‚ show_ver.ymlâ”‚   â”‚ config.yml â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Ansible Core   â”‚
                        â”‚  (NetBox Inv)   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                  â–¼                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚vIOS-R1 â”‚        â”‚vIOS-R2 â”‚        â”‚vIOS-R3 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ  Home LAB Setup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ansible Node   â”‚      â”‚      NetBox      â”‚      â”‚     EVE-NG       â”‚
â”‚  192.168.1.119   â”‚      â”‚  192.168.1.120   â”‚      â”‚  192.168.1.100   â”‚
â”‚                  â”‚      â”‚                  â”‚      â”‚                  â”‚
â”‚ - Claude CLI     â”‚      â”‚ - Device Data    â”‚      â”‚ - vIOS-R1 (.201) â”‚
â”‚ - Ansible MCP    â”‚      â”‚                  â”‚      â”‚ - vIOS-R2 (.202) â”‚
â”‚ - Ansible Core   â”‚      â”‚                  â”‚      â”‚ - vIOS-R3 (.203) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ Project Structure

```
~/mcp-servers/
â”œâ”€â”€ device-mcp/              # From Video 13
â”œâ”€â”€ netbox-mcp-server/       # From Video 12
â””â”€â”€ ansible-mcp/             # NEW - This video
    â”œâ”€â”€ .venv/               # Virtual environment
    â””â”€â”€ ansible_mcp.py       # MCP server script
```

### ğŸ’» Commands

<details>
<summary>1. Prerequisites - Verify Video 14 Setup</summary>

```bash
# Activate ansible environment
netdev
cd ~/ansible-project

# Verify dynamic inventory works
ansible-inventory --graph

# Expected: Shows vIOS-R1, R2, R3 from NetBox
```

</details>

<details>
<summary>2. Create Ansible MCP Folder</summary>

```bash
# Create folder (consistent with other MCPs)
mkdir -p ~/mcp-servers/ansible-mcp
cd ~/mcp-servers/ansible-mcp
```

</details>

<details>
<summary>3. Create Virtual Environment</summary>

```bash
# Create venv
python3 -m venv .venv

# Activate it
source .venv/bin/activate

# Verify you're in venv
which python
# Should show: /home/user/mcp-servers/ansible-mcp/.venv/bin/python
```

</details>

<details>
<summary>4. Install FastMCP</summary>

```bash
# Install FastMCP (inside venv)
pip install fastmcp

# Verify
pip show fastmcp
```

</details>

<details>
<summary>5. Create Ansible MCP Server</summary>

```bash
# Create the MCP server file
cat << 'EOF' > ansible_mcp.py
#!/usr/bin/env python3
"""Ansible MCP Server - Run playbooks via natural language"""

from mcp.server.fastmcp import FastMCP
import subprocess
from pathlib import Path

mcp = FastMCP("Ansible MCP Server")

ANSIBLE_DIR = Path.home() / "ansible-project"
PLAYBOOK_DIR = ANSIBLE_DIR / "playbooks"

@mcp.tool()
def list_playbooks() -> str:
    """List all available Ansible playbooks"""
    playbooks = list(PLAYBOOK_DIR.glob("*.yml"))
    if not playbooks:
        return "No playbooks found"
    result = "Available playbooks:\n"
    for pb in playbooks:
        result += f"  - {pb.name}\n"
    return result

@mcp.tool()
def run_playbook(playbook: str, limit: str = None) -> str:
    """
    Run an Ansible playbook
    
    Args:
        playbook: Playbook filename (e.g., backup_config.yml)
        limit: Limit to hosts/groups (e.g., sites_main-dc, vIOS-R1)
    """
    playbook_path = PLAYBOOK_DIR / playbook
    if not playbook_path.exists():
        return f"Error: Playbook '{playbook}' not found"
    
    # IMPORTANT: Use absolute path to ansible-playbook from your ansible venv
    cmd = ["/home/user/ansible-project/ansible-venv/bin/ansible-playbook", str(playbook_path)]
    if limit:
        cmd.extend(["--limit", limit])
    
    try:
        result = subprocess.run(
            cmd, cwd=ANSIBLE_DIR,
            capture_output=True, text=True, timeout=300
        )
        return result.stdout + result.stderr
    except Exception as e:
        return f"Error: {str(e)}"

@mcp.tool()
def get_inventory() -> str:
    """Get current Ansible inventory from NetBox"""
    result = subprocess.run(
        # IMPORTANT: Use absolute path to ansible-inventory
        ["/home/user/ansible-project/ansible-venv/bin/ansible-inventory", "--graph"],
        cwd=ANSIBLE_DIR, capture_output=True, text=True
    )
    return result.stdout

if __name__ == "__main__":
    mcp.run()
EOF

# Make executable
chmod +x ansible_mcp.py
```

</details>

<details>
<summary>6. Create Backup Playbook</summary>

```bash
# Create backup playbook in ansible-project
cat << 'EOF' > ~/ansible-project/playbooks/backup_config.yml
---
- name: Backup Device Configuration
  hosts: all
  gather_facts: no
  vars:
    ansible_user: ansible
    ansible_ssh_password: ansible@123
    backup_dir: "{{ playbook_dir }}/../backups"

  tasks:
    - name: Create backup directory
      delegate_to: localhost
      file:
        path: "{{ backup_dir }}"
        state: directory
      run_once: true

    - name: Backup running config
      raw: show running-config
      register: config

    - name: Save config
      delegate_to: localhost
      copy:
        content: "{{ config.stdout }}"
        dest: "{{ backup_dir }}/{{ inventory_hostname }}.cfg"
EOF
```

</details>

<details>
<summary>7. Add MCP Server to Claude CLI</summary>

```bash
# Add to Claude CLI (use full paths)
claude mcp add ansible-mcp \
  /home/user/mcp-servers/ansible-mcp/.venv/bin/python \
  /home/user/mcp-servers/ansible-mcp/ansible_mcp.py

# Verify connection
claude mcp list

# Expected: ansible-mcp: ... - âœ“ Connected
```

</details>

<details>
<summary>8. Test with Claude</summary>

```bash
# Start Claude CLI
claude

# Try these queries:
# "List available playbooks"
# "Show me the current inventory"
# "Run backup_config playbook on all routers"
# "Run backup on vIOS-R1 only"
```

</details>

### ğŸ”§ Troubleshooting

<details>
<summary>Failed to Connect Error</summary>

```bash
# 1. Verify paths exist
ls -la ~/mcp-servers/ansible-mcp/
ls -la ~/mcp-servers/ansible-mcp/.venv/bin/python

# 2. Test import manually
cd ~/mcp-servers/ansible-mcp
source .venv/bin/activate
python -c "from mcp.server.fastmcp import FastMCP; print('OK')"

# 3. Remove and re-add
claude mcp remove ansible-mcp
claude mcp add ansible-mcp \
  /home/user/mcp-servers/ansible-mcp/.venv/bin/python \
  /home/user/mcp-servers/ansible-mcp/ansible_mcp.py
```

</details>

<details>
<summary>Playbook Not Found Error</summary>

```bash
# Check playbook directory
ls -la ~/ansible-project/playbooks/

# Verify ANSIBLE_DIR in script matches your setup
```

</details>

### ğŸ“¦ Example Queries

```bash
# List playbooks
"What Ansible playbooks are available?"

# Run on all devices
"Run the backup playbook on all routers"

# Run on specific group (from NetBox)
"Backup configs for devices in sites_main-dc"

# Run on single device
"Execute show_version playbook on vIOS-R1 only"
```

---



## Video 16: Gemini CLI + Remote MCP

[â–¶ï¸ Watch on YouTube](https://www.youtube.com/watch?v=rN9GJgPKeCQ)

### ğŸ“‹ Overview

Use Google's FREE Gemini CLI with remote MCP servers. Access your network automation from anywhere - no paid subscription required!

### ğŸ¯ What You'll Learn

- Build unified MCP server with SSE transport
- Install and configure Gemini CLI on Windows
- Generate and configure FREE Google API key
- Connect remote MCP server from any machine
- Understand rate limits and token usage

### ğŸ†š Why Gemini CLI?

| Feature | Claude CLI | Gemini CLI |
|---------|------------|------------|
| **Cost** | Subscription | âœ… FREE |
| **MCP Support** | Yes | âœ… Yes |
| **Remote Access** | Local (stdio) | âœ… Remote (SSE) |
| **Auth** | Claude account | Google API key |

### ğŸ¤– Gemini Models Overview

| Model | Best For | Rate Limit | Speed |
|-------|----------|------------|-------|
| `gemini-2.5-flash` | General use | ~15 req/min | Fast |
| `gemini-2.5-flash-lite` | High volume | Higher | Faster |
| `gemini-2.5-pro` | Complex tasks | ~2 req/min | Slower |

> **Tip:** Use `gemini-2.5-flash` for network automation - good balance of speed and capability.

### ğŸ“Š Understanding Token Usage

```
Model Usage                 Reqs   Input Tokens   Cache Reads  Output Tokens
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
gemini-2.5-flash-lite          8         9,707         2,505            420
gemini-2.5-flash              12        16,213        59,036            111
```

| Term | Meaning |
|------|---------|
| **Reqs** | Number of API requests made |
| **Input Tokens** | Tokens sent TO the model (your prompts) |
| **Cache Reads** | Cached tokens reused (saves quota) |
| **Output Tokens** | Tokens returned FROM the model (responses) |

> **Rate Limit vs Daily Quota:**
> - **Rate Limit (429):** Too many requests per minute â†’ Wait 1-2 minutes
> - **Daily Quota:** Exceeded daily limit â†’ Wait until midnight PST

### ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GEMINI CLI + REMOTE MCP ARCHITECTURE                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    WINDOWS LAPTOP/PC        â”‚              â”‚      ANSIBLE NODE (.119)        â”‚
â”‚       (Anywhere)            â”‚              â”‚                                 â”‚
â”‚                             â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚  â”‚   Unified MCP Server      â”‚  â”‚
â”‚  â”‚      Gemini CLI       â”‚  â”‚   HTTP/SSE   â”‚  â”‚   (Port 8080)             â”‚  â”‚
â”‚  â”‚                       â”‚  â”‚   â•â•â•â•â•â•â•â•>  â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚  "Backup all routers" â”‚  â”‚  Port 8080   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚  â”‚  â”‚   NetBox Tools      â”‚  â”‚  â”‚
â”‚                             â”‚              â”‚  â”‚  â”‚   - list_devices    â”‚  â”‚  â”‚
â”‚   Google API Key (FREE)     â”‚              â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚                             â”‚              â”‚  â”‚                           â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
                                             â”‚  â”‚  â”‚   Ansible Tools     â”‚  â”‚  â”‚
                                             â”‚  â”‚  â”‚   - list_playbooks  â”‚  â”‚  â”‚
                                             â”‚  â”‚  â”‚   - run_playbook    â”‚  â”‚  â”‚
                                             â”‚  â”‚  â”‚   - get_inventory   â”‚  â”‚  â”‚
                                             â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
                                             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                             â”‚                â–¼                â”‚
                                             â”‚         Network Devices         â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”„ Local vs Remote MCP

```
VIDEOS 12-15: LOCAL MCP (stdio)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Same Machine Only               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  stdio   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Claude   â”‚ â”€â”€â”€â”€â”€â”€â”€â–º â”‚   MCP    â”‚       â”‚
â”‚  â”‚   CLI    â”‚          â”‚  Server  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

VIDEO 16: REMOTE MCP (SSE)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Access from ANYWHERE                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   HTTP/SSE    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ Gemini   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â–º â”‚   MCP    â”‚                      â”‚
â”‚  â”‚   CLI    â”‚   Internet    â”‚  Server  â”‚                      â”‚
â”‚  â”‚(Windows) â”‚               â”‚ (Linux)  â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”§ Single Agent + Multi-Tool

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚    Gemini CLI   â”‚
                         â”‚   (ONE Agent)   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   MCP Server    â”‚
                         â”‚  (Multi-Tool)   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                      â–¼                      â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  NetBox Tools   â”‚    â”‚  Ansible Tools  â”‚    â”‚ (Future Tools)  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NOTE: This is NOT multi-agent. It's ONE AI with MULTIPLE tools.
```

### ğŸ“ Project Structure

```
~/mcp-servers/
â”œâ”€â”€ netbox-mcp-server/       # Video 12 (Local)
â”œâ”€â”€ device-mcp/              # Video 13 (Local)
â”œâ”€â”€ ansible-mcp/             # Video 15 (Local)
â””â”€â”€ unified-mcp-sse/         # Video 16 (Remote!) â† NEW
    â”œâ”€â”€ .venv/
    â””â”€â”€ unified_mcp_sse.py
```

---


## ğŸ–¥ï¸ PART 1: Server Setup (Ansible Node)

<details>
<summary>ğŸ’» Step 1.1: Create Project Folder</summary>

```bash
# On Ansible Node (192.168.1.119)
cd ~/mcp-servers
mkdir -p unified-mcp-sse
cd unified-mcp-sse

# Verify
pwd
# Expected: /home/user/mcp-servers/unified-mcp-sse
```

</details>

<details>
<summary>ğŸ’» Step 1.2: Create Virtual Environment</summary>

```bash
# Create venv
python3 -m venv .venv

# Activate
source .venv/bin/activate

# Verify - should show venv path
which python
# Expected: /home/user/mcp-servers/unified-mcp-sse/.venv/bin/python
```

</details>

<details>
<summary>ğŸ’» Step 1.3: Install Dependencies</summary>

```bash
# Install required packages
pip install fastmcp requests uvicorn

# Verify installations
pip show fastmcp | grep Version
pip show uvicorn | grep Version

# Expected output:
# Version: 2.x.x (fastmcp)
# Version: 0.x.x (uvicorn)
```

</details>

<details>
<summary>ğŸ’» Step 1.4: Get NetBox API Token</summary>

```bash
# If you don't know your token, get it from NetBox UI:
# 1. Login to NetBox: http://192.168.1.120:8000
# 2. Go to: Admin â†’ API Tokens â†’ Add Token
# 3. Copy the token

# Test NetBox API connectivity
curl -s http://192.168.1.120:8000/api/dcim/devices/ \
  -H "Authorization: Token YOUR-NETBOX-TOKEN" | head -100

# Should return JSON with device list
```

</details>

<details>
<summary>ğŸ’» Step 1.5: Create Unified MCP Server</summary>

```bash
# Create the server file
cat << 'EOF' > unified_mcp_sse.py
#!/usr/bin/env python3
"""Unified MCP Server with SSE Transport for Remote Access"""

from mcp.server.fastmcp import FastMCP
import subprocess
import requests
from pathlib import Path
import uvicorn

mcp = FastMCP("Network Automation MCP")

# ============================================
# CONFIGURATION - UPDATE THESE VALUES!
# ============================================
ANSIBLE_DIR = Path.home() / "ansible-project"
ANSIBLE_BIN = Path.home() / "ansible-project/ansible-venv/bin"
NETBOX_URL = "http://192.168.1.120:8000"
NETBOX_TOKEN = "YOUR-NETBOX-TOKEN-HERE"  # â† UPDATE THIS!

# ============================================
# NETBOX TOOLS
# ============================================
@mcp.tool()
def netbox_list_devices() -> str:
    """List devices with IPs from NetBox (direct API - fast query)"""
    try:
        headers = {"Authorization": f"Token {NETBOX_TOKEN}"}
        r = requests.get(f"{NETBOX_URL}/api/dcim/devices/", headers=headers, timeout=10)
        r.raise_for_status()
        devices = r.json().get('results', [])
        if not devices:
            return "No devices found in NetBox"
        result = "Devices in NetBox:\n"
        for d in devices:
            ip = d.get('primary_ip4', {})
            ip_addr = ip.get('address', 'No IP') if ip else 'No IP'
            result += f"  - {d['name']} ({ip_addr})\n"
        return result
    except Exception as e:
        return f"Error connecting to NetBox: {str(e)}"

# ============================================
# ANSIBLE TOOLS
# ============================================
@mcp.tool()
def ansible_list_playbooks() -> str:
    """List all available Ansible playbooks"""
    playbooks = list((ANSIBLE_DIR / "playbooks").glob("*.yml"))
    if not playbooks:
        return "No playbooks found in " + str(ANSIBLE_DIR / "playbooks")
    result = "Available playbooks:\n"
    for p in playbooks:
        result += f"  - {p.name}\n"
    return result

@mcp.tool()
def ansible_run_playbook(playbook: str, limit: str = None) -> str:
    """Run an Ansible playbook with optional host limit"""
    playbook_path = ANSIBLE_DIR / "playbooks" / playbook
    if not playbook_path.exists():
        return f"Error: Playbook '{playbook}' not found at {playbook_path}"
    
    # IMPORTANT: Use absolute path to ansible-playbook from your venv
    ansible_cmd = str(ANSIBLE_BIN / "ansible-playbook")
    cmd = [ansible_cmd, str(playbook_path)]
    if limit:
        cmd.extend(["--limit", limit])
    
    try:
        result = subprocess.run(
            cmd, cwd=ANSIBLE_DIR,
            capture_output=True, text=True, timeout=300
        )
        output = result.stdout + result.stderr
        return output if output else "Playbook executed (no output)"
    except subprocess.TimeoutExpired:
        return "Error: Playbook execution timed out (5 min limit)"
    except Exception as e:
        return f"Error running playbook: {str(e)}"

@mcp.tool()
def ansible_get_inventory() -> str:
    """Get Ansible inventory groups and hosts (via NetBox dynamic inventory)"""
    ansible_cmd = str(ANSIBLE_BIN / "ansible-inventory")
    try:
        result = subprocess.run(
            [ansible_cmd, "--graph"],
            cwd=ANSIBLE_DIR, capture_output=True, text=True, timeout=30
        )
        output = result.stdout
        return f"Ansible Inventory:\n{output}" if output else "No inventory data"
    except Exception as e:
        return f"Error getting inventory: {str(e)}"

# ============================================
# HOST HEADER FIX FOR REMOTE ACCESS
# ============================================
class HostFixMiddleware:
    """Middleware to fix host header for remote SSE connections"""
    def __init__(self, app):
        self.app = app

    async def __call__(self, scope, receive, send):
        if scope["type"] == "http":
            headers = []
            for name, value in scope.get("headers", []):
                if name == b"host":
                    value = b"localhost:8080"
                headers.append((name, value))
            scope["headers"] = headers
        await self.app(scope, receive, send)

# ============================================
# MAIN - START SERVER
# ============================================
if __name__ == "__main__":
    print("=" * 50)
    print("Starting Unified MCP Server")
    print("=" * 50)
    print(f"NetBox URL: {NETBOX_URL}")
    print(f"Ansible Dir: {ANSIBLE_DIR}")
    print(f"Listening on: http://0.0.0.0:8080")
    print("=" * 50)
    
    # Wrap SSE app with host fix middleware
    app = HostFixMiddleware(mcp.sse_app())
    
    # Start uvicorn server
    uvicorn.run(app, host="0.0.0.0", port=8080)
EOF

# Make executable
chmod +x unified_mcp_sse.py
```

</details>

<details>
<summary>ğŸ’» Step 1.6: Update Configuration</summary>

```bash
# Edit the file to add your NetBox token
nano unified_mcp_sse.py

# Find this line and update:
NETBOX_TOKEN = "YOUR-NETBOX-TOKEN-HERE"  # â† Put your actual token

# Save: Ctrl+O, Enter, Ctrl+X
```

</details>

<details>
<summary>ğŸ’» Step 1.7: Start MCP Server</summary>

```bash
# Start the server
python unified_mcp_sse.py

# Expected output:
# ==================================================
# Starting Unified MCP Server
# ==================================================
# NetBox URL: http://192.168.1.120:8000
# Ansible Dir: /home/user/ansible-project
# Listening on: http://0.0.0.0:8080
# ==================================================
# INFO:     Started server process [xxxxx]
# INFO:     Waiting for application startup.
# INFO:     Application startup complete.
# INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
```

</details>

<details>
<summary>ğŸ’» Step 1.8: Verify Port is Listening (New Terminal)</summary>

```bash
# Open new terminal, check port
ss -tlnp | grep 8080

# Expected:
# LISTEN 0 2048 0.0.0.0:8080 0.0.0.0:* users:(("python",pid=xxxx,fd=6))
```

</details>

<details>
<summary>ğŸ’» Step 1.9: Test SSE Endpoint Locally</summary>

```bash
# Test the SSE endpoint (will hang - that's normal for SSE)
curl http://localhost:8080/sse

# Press Ctrl+C to stop
# If you see "Invalid Host header" - the middleware isn't working
# If it hangs waiting - that's correct! SSE keeps connection open
```

</details>

<details>
<summary>ğŸ’» Step 1.10: Check Firewall</summary>

```bash
# Allow port 8080 through firewall
sudo ufw allow 8080/tcp

# Check status
sudo ufw status

# If firewall inactive, that's fine - port is open
```

</details>

---

## ğŸ’» PART 2: Client Setup (Windows)

<details>
<summary>ğŸ’» Step 2.1: Install Node.js (if not installed)</summary>

```powershell
# Check if Node.js is installed
node --version

# If not installed:
# 1. Go to https://nodejs.org
# 2. Download LTS version
# 3. Run installer (all defaults)
# 4. Restart PowerShell
```

</details>

<details>
<summary>ğŸ’» Step 2.2: Install Gemini CLI</summary>

```powershell
# Install Gemini CLI globally
npm install -g @google/gemini-cli

# Verify installation
gemini --version

# Expected: 0.24.x or higher
```

</details>

<details>
<summary>ğŸ’» Step 2.3: Generate Google API Key (FREE)</summary>

```
1. Open browser: https://aistudio.google.com/apikey

2. Sign in with Google account

3. Click "Create API key in new project"
   (This auto-creates a Google Cloud project)

4. Copy the API key (starts with "AIza...")

5. Keep this key safe - you'll need it next!
```

</details>

<details>
<summary>ğŸ’» Step 2.4: Configure API Key (Permanent)</summary>

```powershell
# Create PowerShell profile (if doesn't exist)
New-Item -Path $PROFILE -ItemType File -Force

# Open profile in notepad
notepad $PROFILE

# Add this line (replace with YOUR key):
$env:GEMINI_API_KEY = "AIzaSy...your-key-here"

# Save and close notepad

# Restart PowerShell for changes to take effect
```

</details>

<details>
<summary>ğŸ’» Step 2.5: Verify API Key is Set</summary>

```powershell
# After restarting PowerShell, verify:
echo $env:GEMINI_API_KEY

# Should display your API key
# If empty - profile didn't load, try again
```

</details>

<details>
<summary>ğŸ’» Step 2.6: Test Connectivity to Server</summary>

```powershell
# Test if you can reach the MCP server (use curl.exe, not PowerShell alias)
curl.exe http://192.168.1.119:8080/sse

# Expected: Connection stays open (SSE stream)
# Press Ctrl+C to stop

# If "Connection refused" - check server is running
# If timeout - check firewall/network
```

</details>

<details>
<summary>ğŸ’» Step 2.7: Register MCP Server with Gemini CLI</summary>

**Option A: Use Gemini CLI command**

```powershell
# Add remote MCP server (single line - no backslashes in PowerShell)
gemini mcp add network-automation --transport sse --url http://192.168.1.119:8080/sse --scope user

# Verify
gemini mcp list
```

**Option B: Manually edit settings file (if Option A doesn't save URL)**

```powershell
# Open settings file
notepad $env:USERPROFILE\.gemini\settings.json

# Add this content:
```

```json
{
  "mcpServers": {
    "network-automation": {
      "url": "http://192.168.1.119:8080/sse",
      "type": "sse"
    }
  }
}
```

```powershell
# Save and close notepad

# NOTE: Gemini CLI has a bug that sometimes doesn't save the URL
# If 'gemini mcp list' shows empty URL, use Option B
```

</details>

<details>
<summary>ğŸ’» Step 2.8: Verify MCP Connection</summary>

```powershell
# Check MCP server status
gemini mcp list

# Expected output:
# Configured MCP servers:
# âœ“ network-automation: http://192.168.1.119:8080/sse (sse) - Connected

# If shows "Disconnected":
# 1. Check server is running on Ansible node
# 2. Check URL in settings.json is correct
# 3. Check firewall allows port 8080
```

</details>

---

## ğŸ§ª PART 3: Testing

<details>
<summary>ğŸ’» Step 3.1: Start Gemini CLI</summary>

```powershell
# Start Gemini
gemini

# You should see the Gemini banner and prompt
# Look for "1 MCP server" message at bottom
```

</details>

<details>
<summary>ğŸ’» Step 3.2: Test Queries</summary>

```
# Query 1: List NetBox devices
> List all devices in NetBox

# Expected: Shows devices from NetBox
# Look for: âœ“ netbox_list_devices (network-automation MCP Server)

# Query 2: List playbooks
> Show available Ansible playbooks

# Expected: Shows .yml files from ~/ansible-project/playbooks

# Query 3: Get inventory
> Show the Ansible inventory

# Expected: Shows host groups from NetBox dynamic inventory

# Query 4: Run playbook (be careful!)
> Run backup_config playbook on vIOS-R1
```

</details>

<details>
<summary>ğŸ’» Step 3.3: Check Token Usage</summary>

```powershell
# Exit Gemini CLI (Ctrl+C or type /exit)

# Check usage at:
# https://aistudio.google.com/apikey
# Click on your key â†’ View metrics

# Understanding the metrics:
# - Reqs: Number of API requests
# - Input Tokens: Your prompts sent to model
# - Cache Reads: Reused tokens (saves quota)
# - Output Tokens: Model responses
```

</details>

---

## ğŸ”§ Troubleshooting

<details>
<summary>âŒ "Disconnected" in gemini mcp list</summary>

```powershell
# 1. Check server is running (on Ansible Node)
ps aux | grep unified_mcp

# 2. Check port is open
ss -tlnp | grep 8080

# 3. Test connectivity from Windows
curl.exe http://192.168.1.119:8080/sse

# 4. Verify settings.json has correct URL
cat $env:USERPROFILE\.gemini\settings.json
```

</details>

<details>
<summary>âŒ "Invalid Host header" error</summary>

```bash
# The HostFixMiddleware should fix this
# Make sure unified_mcp_sse.py has the middleware class

# Restart server after any changes
pkill -f unified_mcp
python unified_mcp_sse.py
```

</details>

<details>
<summary>âŒ "Rate limit exceeded" or "429 TooManyRequests"</summary>

```
This is per-minute rate limiting, NOT daily quota.

Solution: Wait 1-2 minutes and try again.

To avoid:
- Don't spam requests quickly
- Wait a few seconds between queries
```

</details>

<details>
<summary>âŒ "Daily quota exhausted"</summary>

```
Free tier daily limits reached.

Solutions:
1. Wait until midnight PST (quota resets)
2. Switch to different model: /model â†’ select gemini-2.5-flash-lite
3. Create new API key with different Google account
```

</details>

<details>
<summary>âŒ "No devices found in NetBox"</summary>

```bash
# 1. Check NetBox token in script
grep NETBOX_TOKEN ~/mcp-servers/unified-mcp-sse/unified_mcp_sse.py

# 2. Test NetBox API directly
curl http://192.168.1.120:8000/api/dcim/devices/ \
  -H "Authorization: Token YOUR-TOKEN"

# 3. Restart server after fixing token
pkill -f unified_mcp
python unified_mcp_sse.py
```

</details>

<details>
<summary>âŒ GEMINI_API_KEY not set</summary>

```powershell
# Check if variable is set
echo $env:GEMINI_API_KEY

# Set for current session
$env:GEMINI_API_KEY = "your-key-here"

# Or check profile loaded
cat $PROFILE
```

</details>

<details>
<summary>âŒ Gemini CLI not saving URL (mcp add bug)</summary>

```powershell
# Check what was saved
cat $env:USERPROFILE\.gemini\settings.json

# If URL is empty "", manually edit:
notepad $env:USERPROFILE\.gemini\settings.json

# Replace content with:
{
  "mcpServers": {
    "network-automation": {
      "url": "http://192.168.1.119:8080/sse",
      "type": "sse"
    }
  }
}

# Save and verify
gemini mcp list
```

</details>

### ğŸ” Security Recommendations

| Risk | Mitigation |
|------|------------|
| Open port 8080 | Use VPN or SSH tunnel for production |
| API key in profile | Don't share your PowerShell profile |
| NetBox token in script | Use environment variables in production |
| HTTP unencrypted | Use nginx + SSL for production |

---

## ğŸ“¦ Example Queries

```bash
# NetBox queries
"What devices do we have in NetBox?"
"List all network devices"

# Ansible queries
"Show me available playbooks"
"What's in the Ansible inventory?"

# Automation (careful - these make changes!)
"Run backup_config playbook on all routers"
"Deploy NTP configuration on vIOS-R1"
"Run show_version playbook on device_roles_router"
```

---


## ğŸš€ AWX Series - Coming Next!

The next phase of our Network Automation journey - Enterprise-grade automation with Ansible AWX!

### ğŸ“º AWX Video Index

| # | Video | Topic | Status |
|---|-------|-------|--------|
| 17 | [AWX Installation](#video-17-awx-installation-on-k3s) | K3s, Kubernetes, AWX | ğŸ”œ Coming Soon |
| 18 | [AWX Git Integration](#video-18-awx-git-integration) | GitHub/GitLab, Projects | ğŸ”œ Coming Soon |
| 19 | [AWX NetBox Inventory](#video-19-awx-netbox-inventory) | Dynamic Inventory | ğŸ”œ Coming Soon |
| 20 | [Execution Environments](#video-20-execution-environments) | Custom EE, Docker | ğŸ”œ Coming Soon |
| 21 | [AWX + Claude Code](#video-21-awx-claude-code-integration) | AI Agent + AWX API | ğŸ”œ Coming Soon |
| 22 | [AWX MCP Server](#video-22-awx-mcp-server) | Custom MCP for AWX | ğŸ”œ Coming Soon |
| 23 | [AWX + Gemini CLI](#video-23-awx-gemini-cli) | Free Remote AWX | ğŸ”œ Coming Soon |

---

## Video 17: AWX Installation on K3s

ğŸ”œ **Coming Soon**

### ğŸ“‹ Overview

Deploy Ansible AWX on lightweight K3s Kubernetes inside your EVE-NG lab. Transform your Ansible CLI workflows into enterprise-grade automation with a web UI.

### â“ Why AWX in 2025?

| Challenge | Ansible CLI | AWX Solution |
|-----------|-------------|--------------|
| Who ran what? | Check bash history | âœ… Complete audit trail |
| Team access | Share SSH keys | âœ… Role-based access (RBAC) |
| Scheduling | Cron jobs | âœ… Built-in scheduler |
| Credentials | Plain text files | âœ… Encrypted credential store |
| Visibility | Terminal only | âœ… Web dashboard |
| GitOps | Manual git pull | âœ… Auto-sync from repos |

**Real-world value:** NOC teams can run playbooks without CLI access. Junior engineers get guardrails. Management gets visibility.

### ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”
â”‚                           EVE-NG SERVER                                      â”‚
â”‚                         192.168.1.100                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”¤ 
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ 
â”‚   â”‚                    AWX NODE (Ubuntu Linux)                          â”‚    â”‚   
â”‚   â”‚                      192.168.1.121                                  â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚   â”‚   â”‚                 K3s Kubernetes Cluster                      â”‚   â”‚    â”‚
â”‚   â”‚   â”‚                                                                 â”‚    â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚   â”‚    â”‚
â”‚   â”‚   â”‚  â”‚  AWX Web  â”‚  â”‚ AWX Task  â”‚  â”‚  AWX EE   â”‚                â”‚   â”‚    â”‚
â”‚   â”‚   â”‚  â”‚  (nginx)  â”‚  â”‚ (celery)  â”‚  â”‚(container)â”‚                â”‚   â”‚    â”‚
â”‚   â”‚   â”‚  â”‚ Port 30052 â”‚  â”‚           â”‚  â”‚           â”‚               â”‚   â”‚    â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚   â”‚    â”‚
â”‚   â”‚   â”‚                                                             â”‚   â”‚    â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚   â”‚    â”‚
â”‚   â”‚   â”‚  â”‚PostgreSQL â”‚  â”‚   Redis   â”‚                               â”‚   â”‚    â”‚
â”‚   â”‚   â”‚  â”‚    DB     â”‚  â”‚   Cache   â”‚                               â”‚   â”‚    â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚   â”‚    â”‚
â”‚   â”‚   â”‚                                                             â”‚   â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â”‚   Requirements: 4 vCPU | 8GB RAM | 50GB Disk                        â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                           â”‚                                  â”‚
â”‚                                           â”‚ SSH/API                          â”‚
â”‚                                           â–¼                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                      Network Devices                                â”‚    â”‚
â”‚   â”‚              vIOS-R1 (.201)  vIOS-R2 (.202)  vIOS-R3 (.203)         â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”˜
```

### ğŸ“¦ What Gets Installed

| Component | Purpose |
|-----------|---------|
| K3s | Lightweight Kubernetes (single binary, ~512MB RAM) |
| AWX Operator | Manages AWX lifecycle in Kubernetes |
| AWX | Web UI, API, task engine, database |
| Helm | Kubernetes package manager |

### ğŸ’» Commands

<details>
<summary>1. Prepare Ubuntu Linux Node in EVE-NG</summary>

```bash
# Clone from your golden image (Video 2) or create new node
# specs: 2 vCPU, 4GB RAM

# Set hostname
sudo hostnamectl set-hostname awx-server

# Verify resources
free -h          # Should show 8GB+ RAM
nproc            # Should show 4+ CPUs
df -h            # Should show 50GB+ disk

# Update system
sudo dnf update -y

# Disable firewall (lab only - enable in production)
sudo systemctl disable firewalld --now

# Disable SELinux (lab only)
sudo setenforce 0
sudo sed -i 's/SELINUX=enforcing/SELINUX=permissive/' /etc/selinux/config

# Get IP address
ip addr show eth0 | grep inet
# Note: 192.168.1.121 (example)
```

</details>

<details>
<summary>2. Install K3s (Lightweight Kubernetes)</summary>

```bash
# Install K3s - single command!
curl -sfL https://get.k3s.io | sh -

# If that doesn't work - Download the install script manually
wget -O k3s-install.sh https://get.k3s.io

# Make executable
chmod +x k3s-install.sh

# Run with INSTALL_K3S_SKIP_DOWNLOAD first to see if script works
sudo ./k3s-install.sh

# Wait for K3s to start (30-60 seconds)
sleep 60

# Verify K3s is running
sudo systemctl status k3s

# Check node is ready
sudo kubectl get nodes
# Expected: awx-server   Ready    control-plane,master   1m   v1.28.x

# Setup kubectl for regular user (optional but recommended)
mkdir -p ~/.kube
sudo cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
sudo chown $(id -u):$(id -g) ~/.kube/config

# Add KUBECONFIG to your profile so it persists
echo 'export KUBECONFIG=~/.kube/config' >> ~/.bashrc

# Reload
source ~/.bashrc

# Verify kubectl works without sudo
kubectl get nodes
kubectl get pods -A
```

</details>

<details>
<summary>3. Install Helm Package Manager</summary>

```bash
# Download and install Helm
curl -fsSL https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash

# Verify Helm installation
helm version

# Add AWX Operator Helm repository
helm repo add awx-operator https://ansible-community.github.io/awx-operator-helm/
helm repo update

# Verify repo added
helm search repo awx-operator
```

</details>

<details>
<summary>4. Create AWX Namespace</summary>

```bash
# Create dedicated namespace for AWX
kubectl create namespace awx

# Verify namespace
kubectl get namespaces | grep awx
```

</details>

<details>
<summary>5. Install AWX Operator</summary>
  
```bash
# Install AWX Operator via Helm (do NOT use --wait flag - it times out)
helm install awx-operator awx-operator/awx-operator -n awx

# Watch operator pod come up
kubectl get pods -n awx -w
```

**If pod shows `ImagePullBackOff` or `ErrImagePull`:**

```bash
# Manually pull the image
sudo k3s crictl pull quay.io/ansible/awx-operator:2.19.1

# Delete stuck pod - K8s will recreate it
kubectl delete pod -n awx -l control-plane=controller-manager

# Watch again
kubectl get pods -n awx -w
```

**Wait until you see:**
```
awx-operator-controller-manager-xxxxx   2/2   Running
```

Press `Ctrl+C` when Running.

</details>

<details>
<summary>6. Create AWX Instance Custom Resource</summary>

```bash
# Create AWX instance definition
cat <<EOF | kubectl apply -f -
apiVersion: awx.ansible.com/v1beta1
kind: AWX
metadata:
  name: awx
  namespace: awx
spec:
  service_type: NodePort
  nodeport_port: 30052
EOF

# Verify CR created
kubectl get awx -n awx
```

</details>

<details>
<summary>7. Wait for AWX Deployment </summary>

```bash
# Watch all pods come up - this takes an hours depends your connection & resouces!
kubectl get pods -n awx -w

# Expected final state (all Running):
# awx-operator-controller-manager-xxxxx   2/2     Running
# awx-postgres-15-0                        1/1     Running
# awx-web-xxxxx                            3/3     Running
# awx-task-xxxxx                           4/4     Running

# Check deployment progress
kubectl logs -f deployment/awx-operator-controller-manager -n awx -c awx-manager

# Quick status check
kubectl get pods -n awx
kubectl get svc -n awx
```

</details>

<details>
<summary>8. Get AWX Admin Password</summary>

```bash
# Admin password is stored in a Kubernetes secret
kubectl get secret awx-admin-password -n awx -o jsonpath='{.data.password}' | base64 --decode
# Example output: kT9xPqL2mNvR5wYz

# Save this password! You'll need it to login
# Username: admin
# Password: <output from above command>
```

</details>

<details>
<summary>9. Access AWX Web UI</summary>

```bash
# Get NodePort service details
kubectl get svc -n awx
# Look for: awx-service  NodePort  ...  80:30052/TCP

# AWX URL
echo "AWX URL: http://$(hostname -I | awk '{print $1}'):30052"
# Example: http://192.168.1.129:30052

# Open in browser:
# URL: http://192.168.1.121:30052
# Username: admin
# Password: <from step 8>
```

</details>

<details>
<summary>10. Quick AWX UI Tour</summary>

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AWX DASHBOARD                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸ“Š Dashboard        - Job status, recent activity              â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“ Resources                                                    â”‚
â”‚     â”œâ”€â”€ Templates    - Job templates (playbook + inventory)     â”‚
â”‚     â”œâ”€â”€ Credentials  - SSH keys, API tokens, vault passwords    â”‚
â”‚     â”œâ”€â”€ Projects     - Git repos with playbooks                 â”‚
â”‚     â”œâ”€â”€ Inventories  - Static or dynamic (NetBox!)              â”‚
â”‚     â””â”€â”€ Hosts        - Managed devices                          â”‚
â”‚                                                                  â”‚
â”‚  âš™ï¸ Administration                                               â”‚
â”‚     â”œâ”€â”€ Execution Environments  - Container images for jobs     â”‚
â”‚     â”œâ”€â”€ Instance Groups         - Where jobs run                â”‚
â”‚     â””â”€â”€ Users/Teams             - RBAC configuration            â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“‹ Jobs             - Running and completed jobs               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

</details>

### âœ… Verification Checklist

| Step | Verification Command | Expected Result |
|------|---------------------|-----------------|
| K3s installed | `kubectl get nodes` | Node shows "Ready" |
| Helm installed | `helm version` | Version displayed |
| Operator running | `kubectl get pods -n awx` | Operator pod "Running" |
| AWX deployed | `kubectl get pods -n awx` | All pods "Running" |
| UI accessible | Browser: `http://IP:30052` | Login page appears |
| Login works | Enter admin credentials | Dashboard loads |

### ğŸ”§ Troubleshooting

<details>
<summary>âŒ K3s fails to start</summary>

```bash
# Check K3s logs
sudo journalctl -u k3s -f

# Common fix: Reset and reinstall
sudo /usr/local/bin/k3s-uninstall.sh
curl -sfL https://get.k3s.io | sh -
```

</details>

<details>
<summary>âŒ Pods stuck in Pending/ContainerCreating</summary>

```bash
# Check pod events
kubectl describe pod <pod-name> -n awx

# Check node resources
kubectl describe node | grep -A 5 "Allocated resources"

# Common issue: Not enough memory
free -h
# Solution: Increase VM RAM to 8GB+
```

</details>

<details>
<summary>âŒ Cannot access UI on port 30052</summary>

```bash
# Verify service is running
kubectl get svc -n awx

# Check if port is listening
ss -tlnp | grep 30052

# Test locally first
curl -I http://localhost:30052

# Check firewall (if enabled)
sudo firewall-cmd --add-port=30052/tcp --permanent
sudo firewall-cmd --reload
```

</details>

<details>
<summary>âŒ Forgot admin password</summary>

```bash
# Password is in Kubernetes secret
kubectl get secret awx-admin-password -n awx -o jsonpath='{.data.password}' | base64 --decode

# Or reset password via container
kubectl exec -it deployment/awx-task -n awx -- awx-manage changepassword admin
```

</details>

### ğŸ”— Resources

- [AWX GitHub Repository](https://github.com/ansible/awx)
- [AWX Operator Documentation](https://ansible.readthedocs.io/projects/awx-operator/)
- [K3s Documentation](https://docs.k3s.io/)

---



## ğŸ“ Changelog

### v25.0 (2025-01-18)
- âœ… Video 16: Complete rewrite with step-by-step instructions
  - All steps now collapsible (details/summary)
  - Server setup: 10 detailed steps with verification
  - Client setup: 8 detailed steps with verification
  - Testing section with example queries
  - Added `gemini mcp add` command + manual JSON fallback
  - Comprehensive troubleshooting guide (7 issues)
  - Gemini models and token usage explanation
  - Rate limit vs daily quota explanation
  - HostFixMiddleware for remote SSE connections

### v24.0 (2025-01-17)
- âœ… Video 16: Architecture diagrams and basic setup
- âœ… Video 17: AWX preview added

### v23.0 (2025-01-16)
- âœ… Added AWX Series roadmap (Videos 17-23)

### v22.0 (2025-01-16)
- âœ… Video 15: Fixed ansible_mcp.py absolute paths

---

â­ **If you find this helpful, please star the repo!** â­
